/** @preserve @license @cc_on
 * ----------------------------------------------------------
 * nyang version 0.0.1
 * Not your average network graph 
 * https://github.com/fukurosan/nyang
 * Copyright (c) 2021 Fukurosan
 * All Rights Reserved. MIT License
 * https://mit-license.org/
 * ----------------------------------------------------------
 */
import{select as t,zoomIdentity as e,zoom as n,event as o,mouse as i,selectAll as r,easeBounce as a,line as s,curveCardinal as c,drag as d,easeLinear as l,forceSimulation as u,forceManyBody as E,forceCenter as h,forceY as f,forceX as _,forceLink as g,scalePoint as p}from"d3";function T(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function D(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function O(t,e,n){return e&&D(t.prototype,e),n&&D(t,n),t}function N(t){return function(t){if(Array.isArray(t))return L(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return L(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return L(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function L(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}var v=Object.freeze({ENABLE_ZOOM_BUTTONS:!1,ENABLE_GRID:!1,DEFAULT_FADE_ON_HOVER:!1,DEFAULT_USE_CONTEXT_MENU:!0,SHOW_CONTEXT_MENU:!0,DEFAULT_CUSTOM_CONTEXT_MENU:{},ZOOM_PADDING:40,LABEL_HEIGHT:28,LABEL_WIDTH:80,EDGE_LABEL_PADDING:20,FIXED_EDGE_LABEL_WIDTH:!0,ROTATE_LABELS:!1,MULTIPLICITY_HDISTANCE:20,MULTIPLICITY_VDISTANCE:10,DEFAULT_STROKE_WIDTH:2,DEFAULT_FONT_FAMILY:"Helvetica, Arial, sans-serif",DEFAULT_FONT_SIZE:"12px",DEFAULT_FADE_OPACITY:.3,DEFAULT_FOCUS_COLOR:"#2A6D91",DEFAULT_EDGE_DOTTED_DASHARRAY:3,DEFAULT_EDGE_DASHARRAY:0,DEFAULT_EDGE_COLOR:"#000000",DEFAULT_ARROW_COLOR:"#000000",DEFAULT_MULTIPLICITY_FONT_SIZE:"10px",DEFAULT_EDGE_WIDTH:"2px",DEFAULT_LABEL_TEXT_COLOR:"#000000",DEFAULT_LABEL_TEXT_HOVER_COLOR:"#ffffff",DEFAULT_LABEL_BACKGROUND_COLOR:"#ffffff",DEFAULT_LABEL_HOVER_BACKGROUND_COLOR:"#2A6D91",DEFAULT_LABEL_BORDER_RADIUS_X:"4px",DEFAULT_LABEL_BORDER_RADIUS_Y:"4px",DEFAULT_LABEL_BORDER_WIDTH:"0px",DEFAULT_LABEL_BORDER_COLOR:"transparent",DEFAULT_NODE_DOTTED_DASHARRAY:8,DEFAULT_NODE_STROKE_COLOR:"transparent",DEFAULT_NODE_STROKE_HOVER_COLOR:"transparent",DEFAULT_NODE_COLOR:"#ffffff",DEFAULT_NODE_HOVER_COLOR:"#2A6D91",DEFAULT_NODE_FOCUSED_COLOR:"#ffffff",DEFAULT_NODE_TEXT_COLOR:"#000000",DEFAULT_NODE_TEXT_HOVER_COLOR:"#ffffff",DEFAULT_NODE_TEXT_FOCUSED_COLOR:"#000000",DEFAULT_NODE_BORDER_RADIUS_X:"0px",DEFAULT_NODE_BORDER_RADIUS_Y:"0px",DEFAULT_NODE_FOCUSED_BORDER_WIDTH:"4px",DEFAULT_NODE_HOVER_BORDER_WIDTH:"2px",DEFAULT_RECTANGLE_MAX_HEIGHT:20,DEFAULT_RECTANGLE_MAX_WIDTH:60,DEFAULT_CIRCLE_NODE_RADIUS:50,DEFAULT_NODE_ICON_SIZE:16,DEFAULT_NODE_ICON_PADDING:8,DEFAULT_NODE_TEXT_MULTILINE:!1,DEFAULT_NODE_FILTER:!1,DEFAULT_NODE_HOVER_FILTER:!1,DEFAULT_NODE_FOCUSED_FILTER:!1,TOOLTIP_MIN_WIDTH:"80px",TOOLTIP_MAX_WIDTH:"150px",TOOLTIP_BACKGROUND:"black",TOOLTIP_COLOR:"white",TOOLTIP_BORDER_RADIUS:"2px",HIGHLIGHTING_BORDER_WIDTH:"0px",HIGHLIGHTING_BORDER_COLOR:"transparent",HIGHLIGHTING_COLOR:"#009ADE",ENABLE_ONION_ON_FOCUS:!0,DEFAULT_ONION_FOCUSED_LAYERS:2,DEFAULT_ONION_FOCUSED_COLOR:"#B6D5DB",DEFAULT_ONION_FOCUSED_SIZE:10,DEFAULT_ONION_ANIMATION_TIME:80,DEFAULT_VISIBLE_EDGE_DISTANCE:350,ADDITIONAL_TEXT_SPACE:20,DOUBLE_CLICK_THRESHOLD:300,FADE_TIME:300,ZOOM_TIME:1e3,HIGHLIGHT_TIME:1e3,HIGHLIGHT_TIME_REMOVE:1e3,IMPLOSION_EXPLOSION_ANIMATION_TIME:200,EDGE_STRENGTH:.7,GRAVITY:.06,CHARGE:-2e3,SCALE_EXTENT:[.1,4],INITIAL_SCALE:.3});String.prototype.width=function(e){e||(e="text");var n=t("body").append("div").attr("class",e).attr("style","font-size:12px; position: absolute;float: left;white-space: nowrap;visibility: hidden;").attr("id","width-test").text(this),o=document.getElementById("width-test").offsetWidth;return n.remove(),o},String.prototype.truncate=function(t,e){if(t-=v.ADDITIONAL_TEXT_SPACE,isNaN(t)||t<=0)return this;for(var n,o,i=this,r=this.length;!((n=i.width(e))<=t);)o=n/t,r=Math.floor(r/o),i=i.substring(0,r);return this.length>r?this.substring(0,r-3)+"...":this};var y=Object.freeze({CLICK_ENTITY:"ENTITY_CLICKED_EVENT",DBL_CLICK_ENTITY:"ENTITY_DBL_CLICKED_EVENT",HOVER_ENTITY:"ENTITY_HOVER_EVENT",RIGHT_CLICK_ENTITY:"ENTITY_RIGHT_CLICKED_EVENT",NODE_DRAG_START:"NODE_DRAG_STARTED_EVENT",NODE_DRAG_DRAGGED:"NODE_DRAG_DRAGGED_EVENT",NODE_DRAG_ENDED:"NODE_DRAG_ENDED_EVENT",MOUSE_OVER_NODE:"MOUSE_MOVED_OVER_NODE_EVENT",MOUSE_LEFT_NODE:"MOUSE_MOVED_OUTSIDE_NODE_EVENT",NODE_PIN_MODE_TOGGLED:"NODE_PIN_MODE_TOGGLED",DATA_UPDATE_REQUESTED:"DATA_UPDATE_REQUESTED",DATASTORE_UPDATED:"LIVE_DATA_UPDATED_EVENT",DOM_PROCESSOR_FINISHED:"DOM_PROCESSOR_FINISHED",ENGINE_UPDATE_FINISHED:"ENGINE_UPDATE_FINISHED_EVENT",DATA_FILTER_REQUESTED:"DATA_FILTER_REQUESTED_EVENT",DATA_FILTER_RESET_REQUESTED:"DATA_FILTER_RESET_REQUESTED_EVENT",IMPLODE_EXPLODE_REQUESTED:"IMPLODE_OR_EXPLODE_ENTITIES_REQUESTED_EVENT",IMPLODE_EXPLODE_LEAFS_REQUESTED:"IMPLODE_OR_EXPLODE_ENTITIES_LEAFS_REQUESTED_EVENT",IMPLODE_EXPLODE_RECURSIVE_REQUESTED:"IMPLODE_OR_EXPLODE_ENTITIES_RECURSIVE_REQUESTED_EVENT",IMPLODE_EXPLODE_NON_CIRCULAR_REQUESTED:"IMPLODE_OR_EXPLODE_ENTITIES_NON_CIRCULAR_REQUESTED_EVENT",ZOOM_REQUESTED:"ZOOM_WAS_REQUESTED_EVENT",HIGHLIGHT_NODE_REQUESTED:"HIGHLIGHT_NODE_REQUESTED_EVENT",DISABLE_NODES_REQUESTED:"DISABLE_NODES_REQUESTED_EVENT",CLEAR_DISABLE_NODES_REQUESTED:"CLEAR_DISABLE_NODES_REQUESTED_EVENT",TOGGLE_MULTIPLICITY_REQUESTED:"TOGGLE_MULTIPLICITY_REQUEST_EVENT",ENGINE_TICK:"ENGINE_TICK_EVENT",ENGINE_LAYOUT_REQUESTED:"ENGINE_LAYOUT_REQUESTED_EVENT",ENGINE_LAYOUT_RESET_REQUESTED:"ENGINE_LAYOUT_RESET_REQUESTED_EVENT",GRAPH_HAS_MOUNTED:"GRAPH_HAS_MOUNTED",GRAPH_WILL_UNMOUNT:"GRAPH_WILL_UNMOUNT"}),I=function(){function t(e,n,o){T(this,t),this.style=n,this.fixedEdgeLabelWidth=void 0!==o.enableFixedEdgeLabelWidth?o.enableFixedEdgeLabelWidth:v.FIXED_EDGE_LABEL_WIDTH,this.edgeLabelWidth=o.edgeLabelWidth?o.edgeLabelWidth:v.LABEL_WIDTH,this.maxEdgeLabelWidth=o.maxEdgeLabelWidth?o.maxEdgeLabelWidth:2*v.LABEL_WIDTH,this.ee=e}return O(t,[{key:"executePreProcessor",value:function(t,e){this.updateEdgeNodeIDs(e,t),this.updateEdgeDistances(e),this.updateEdgeLabelWidths(e),this.updateEdgeCounters(e),this.updateNodeParameters(t)}},{key:"pinNode",value:function(t,e,n){t.fx=e,t.fy=n}},{key:"repositionNode",value:function(t,e,n){return t.sourceX=t.x,t.sourceY=t.y,t.targetX=e,t.targetY=n,this.animateNodePositions([t])}},{key:"unPinNode",value:function(t){t.fx=null,t.fy=null}},{key:"updateEdgeNodeIDs",value:function(t,e){t.forEach((function(t){t.source=e.findIndex((function(e){return e.id===t.sourceNode})),t.target=e.findIndex((function(e){return e.id===t.targetNode})),void 0!==t.source&&void 0!==t.target||console.error("Broken Edge",t)}))}},{key:"updateEdgeDistances",value:function(t){var e=this;t.forEach((function(t){if(e.style&&e.style.edges){var n=e.style.edges.find((function(e){return e.id===t.type}));n&&n.edgeDistance?t.edgeDistance=n.edgeDistance:t.edgeDistance=v.DEFAULT_VISIBLE_EDGE_DISTANCE}else t.edgeDistance=v.DEFAULT_VISIBLE_EDGE_DISTANCE}))}},{key:"updateEdgeLabelWidths",value:function(t){var e=this;t.forEach((function(t){if(e.fixedEdgeLabelWidth)t.nameToWidth=e.edgeLabelWidth,t.nameFromWidth=e.edgeLabelWidth;else{if(t.nameTo){var n=t.nameTo.width();n=n<e.maxEdgeLabelWidth?n:e.maxEdgeLabelWidth,t.nameToWidth=n+v.EDGE_LABEL_PADDING}else t.nameToWidth=e.edgeLabelWidth;if(t.nameFrom){var o=t.nameTo.width();o=o<e.maxEdgeLabelWidth?o:e.maxEdgeLabelWidth,t.nameFromWidth=o+v.EDGE_LABEL_PADDING}else t.nameFromWidth=e.edgeLabelWidth}}))}},{key:"updateEdgeCounters",value:function(t){t.forEach((function(e){var n=0;if(isNaN(e.multiEdgeCount)){var o=[];for(t.forEach((function(t){(e.source===t.source&&e.target===t.target||e.target===t.source&&e.source===t.target)&&o.push(t)})),n=0;n<o.length;n++)o[n].multiEdgeCount=o.length,o[n].multiEdgeIndex=n}if(isNaN(e.selfEdgeCount)){var i=[];for(t.forEach((function(t){e.source===t.source&&e.target===t.target&&i.push(t)})),n=0;n<i.length;n++)i[n].selfEdgeCount=i.length,i[n].selfEdgeIndex=n}}))}},{key:"updateNodeParameters",value:function(t){var e=this;t.forEach((function(t){if(e.style&&e.style.nodes){var n=e.style.nodes.find((function(e){return e.id===t.type}));if(n)switch(n.shape){case"circle":case"layeredCircle":t.radius=n.radius?n.radius:v.DEFAULT_CIRCLE_NODE_RADIUS,t.maxTextWidth=2*t.radius,t.shape=n.shape;break;case"rectangle":t.height=n.maxHeight?n.maxHeight:v.DEFAULT_RECTANGLE_MAX_HEIGHT,t.width=n.maxWidth?n.maxWidth:v.DEFAULT_RECTANGLE_MAX_WIDTH,t.maxTextWidth=n.maxWidth?t.icon?n.maxWidth-v.DEFAULT_NODE_ICON_SIZE-v.ADDITIONAL_TEXT_SPACE/2-v.DEFAULT_NODE_ICON_PADDING:n.maxWidth:v.DEFAULT_RECTANGLE_MAX_WIDTH,t.shape=n.shape;break;default:t.radius=n.radius?n.radius:v.DEFAULT_CIRCLE_NODE_RADIUS,t.maxTextWidth=2*t.radius,t.shape=n.shape}else t.radius=v.DEFAULT_CIRCLE_NODE_RADIUS,t.maxTextWidth=2*t.radius,t.shape="circle"}else t.radius=v.DEFAULT_CIRCLE_NODE_RADIUS,t.maxTextWidth=2*t.radius,t.shape="circle"}))}},{key:"animateNodePositions",value:function(t){return new Promise((function(e){t.forEach((function(t){t.originalFx=t.fx,t.originalFy=t.fy,t.fx=t.x,t.fy=t.y,t.animating=!0})),function n(o,i){var r=Date.now()-o;if(r>i)t.forEach((function(t){delete t.targetX,delete t.targetY,delete t.sourceX,delete t.sourceY,delete t.fx,delete t.fy,t.originalFx&&(t.fx=t.originalFx,delete t.originalFx),t.originalFy&&(t.fy=t.originalFy,delete t.originalFy),delete t.animating})),e();else{var a=r/i;t.filter((function(t){return t.targetX&&t.targetY})).forEach((function(t){t.fx=t.sourceX+(t.targetX-t.sourceX)*a,t.fy=t.sourceY+(t.targetY-t.sourceY)*a})),setTimeout((function(){return n(o,i)}),1)}}(Date.now(),v.IMPLOSION_EXPLOSION_ANIMATION_TIME)}))}}]),t}(),m=function(){function t(e,n,o,i,r){var a=this;T(this,t),this.allNodes=JSON.parse(JSON.stringify(e)),this.allEdges=JSON.parse(JSON.stringify(n)),this.liveNodes=this.allNodes,this.liveEdges=this.allEdges,this.filters={nodes:[],edges:[]},this.ee=o,this.ee.on(y.DATA_UPDATE_REQUESTED,(function(t,e){return a.updateDataset(t,e)})),this.ee.on(y.GRAPH_HAS_MOUNTED,(function(){a.entityProcessor.executePreProcessor(a.nodes,a.edges),a.ee.trigger(y.DATASTORE_UPDATED,a.nodes,a.edges)})),this.ee.on(y.DATA_FILTER_REQUESTED,(function(t){a.setFilters(t),a.applyFilters(),a.updateNumberOfHiddenEdgesOnNodes(),a.updateLiveData()})),this.ee.on(y.DATA_FILTER_RESET_REQUESTED,(function(){a.resetAllFilters(),a.applyFilters(),a.updateNumberOfHiddenEdgesOnNodes(),a.updateLiveData()})),this.ee.on(y.IMPLODE_EXPLODE_REQUESTED,(function(t,e){a.implodeOrExplodeNode(t,e),a.updateNumberOfHiddenEdgesOnNodes(),a.implodeExplodedNodesAnimation(t,e)})),this.ee.on(y.IMPLODE_EXPLODE_LEAFS_REQUESTED,(function(t,e){a.implodeOrExplodeNodeLeafs(t,e),a.updateNumberOfHiddenEdgesOnNodes(),a.implodeExplodedNodesAnimation(t,e)})),this.ee.on(y.IMPLODE_EXPLODE_RECURSIVE_REQUESTED,(function(t,e){a.implodeOrExplodeNodeRecursive(t,e),a.updateNumberOfHiddenEdgesOnNodes(),a.implodeExplodedNodesAnimation(t,e)})),this.ee.on(y.IMPLODE_EXPLODE_NON_CIRCULAR_REQUESTED,(function(t,e){a.implodeOrExplodeNodeNonCircular(t,e),a.updateNumberOfHiddenEdgesOnNodes(),a.implodeExplodedNodesAnimation(t,e)})),this.entityProcessor=new I(this.ee,i,r),this.updateEdgeIDs(),this.applyFilters(),this.updateNumberOfHiddenEdgesOnNodes()}return O(t,[{key:"implodeExplodedNodesAnimation",value:function(t,e){var n=this,o=this.getNodeByID(t);this.stageNodePositions(e?null:o.x,e?null:o.y,e?o.x:null,e?o.y:null),e?this.entityProcessor.animateNodePositions(this.allNodes).then((function(){n.updateLiveData()})):(this.updateLiveData(),this.entityProcessor.animateNodePositions(this.allNodes))}},{key:"updateEdgeIDs",value:function(){this.allEdges.forEach((function(t,e){void 0===t.id&&(t.id=e)}))}},{key:"updateDataset",value:function(t,e){var n=JSON.parse(JSON.stringify(t)),o=JSON.parse(JSON.stringify(e));this.allNodes=n,this.allEdges=o,this.updateEdgeIDs(),this.applyFilters(),this.updateNumberOfHiddenEdgesOnNodes(),this.updateLiveData()}},{key:"getNodeByID",value:function(t){return this.allNodes.find((function(e){return e.id===t}))}},{key:"getEdgeByID",value:function(t){return this.allEdges.find((function(e){return e.id===t}))}},{key:"resetAllFilters",value:function(){this.filters={nodes:[],edges:[]}}},{key:"setFilters",value:function(t){var e=[],n=[];t.forEach((function(t){if("node"===t.entityType)e.push({attribute:t.attribute,value:t.value,function:t.filterFunction});else{if("edge"!==t.entityType)throw new Error("No such entity type for filters:",t.entityType);n.push({attribute:t.attribute,value:t.value,function:t.filterFunction})}})),this.filters.nodes=e,this.filters.edges=n}},{key:"applyFilters",value:function(){var t=this;this.allNodes.forEach((function(e){var n=!1;t.filters.nodes.forEach((function(t){n||(t.filterFunction?n=t.filterFunction(e.data):e[t.attribute]===t.value&&(n=!0))})),e.isFiltered=n})),this.allEdges.forEach((function(e){var n=!1;t.filters.edges.forEach((function(t){n||(t.filterFunction?n=t.filterFunction(e.data):e[t.attribute]===t.value&&(n=!0))}));var o=t.allNodes.find((function(t){return e.sourceNode===t.id&&!t.isFiltered})),i=t.allNodes.find((function(t){return e.targetNode===t.id&&!t.isFiltered}));o&&i||(n=!0),e.isFiltered=n}))}},{key:"stageNodePositions",value:function(t,e,n,o){var i=this;if(t||n)if(n&&!t)this.allNodes.filter((function(t){return!i.isNodeLive(t)&&i.liveNodes.find((function(e){return e.id===t.id}))})).forEach((function(t){t.targetX=n,t.targetY=o,t.sourceX=t.x,t.sourceY=t.y}));else if(t&&!n){var r=this.allNodes.filter((function(t){return i.isNodeLive(t)&&!i.liveNodes.find((function(e){return e.id===t.id}))})),a={},s={};r.forEach((function(t){var e=i.allEdges.filter((function(e){return(e.targetNode===t.id||e.sourceNode===t.id)&&e.targetNode!==e.sourceNode})).map((function(e){return e.sourceNode===t.id?{node:i.getNodeByID(e.targetNode),edgeDistance:e.edgeDistance}:{node:i.getNodeByID(e.sourceNode),edgeDistance:e.edgeDistance}})).filter((function(t){return i.liveNodes.includes(t.node)})).reduce((function(t,e){return t.map((function(t){return t.node.id})).includes(e.node.id)||t.push(e),t}),[]);s[t.id]=e,1===e.length&&(Array.isArray(a[e[0].node.id])?a[e[0].node.id].push(t.id):a[e[0].node.id]=[t.id])})),r.forEach((function(n){if(n.sourceX=t+2,n.sourceY=e+2,1===s[n.id].length){var o=a[s[n.id][0].node.id].indexOf(n.id)+1,i=a[s[n.id][0].node.id].length,r=Math.floor(359/i*o);n.targetX=s[n.id][0].node.x+2*s[n.id][0].edgeDistance*Math.cos(r*Math.PI/180),n.targetY=s[n.id][0].node.y+2*s[n.id][0].edgeDistance*Math.sin(r*Math.PI/180)}else 0===s[n.id].length?(n.targetX=0,n.targetY=0):(n.targetX=s[n.id].reduce((function(t,e){return t+e.node.x}),0)/s[n.id].length,n.targetY=s[n.id].reduce((function(t,e){return t+e.node.y}),0)/s[n.id].length)}))}}},{key:"updateLiveData",value:function(){var t=this,e=this.allNodes.filter((function(e){return t.isNodeLive(e)})),n=this.allEdges.filter((function(e){return t.isEdgeLive(e)}));e.forEach((function(e){t.liveNodes.find((function(t){return t.id===e.id}))||t.liveNodes.push(e)})),this.liveNodes=this.liveNodes.filter((function(t){return e.find((function(e){return t.id===e.id}))})),n.forEach((function(e){t.liveEdges.find((function(t){return t.id===e.id}))||t.liveEdges.push(e)})),this.liveEdges=this.liveEdges.filter((function(t){return n.find((function(e){return t.id===e.id}))})),this.entityProcessor.executePreProcessor(this.nodes,this.edges),this.ee.trigger(y.DATASTORE_UPDATED,this.nodes,this.edges)}},{key:"updateNumberOfHiddenEdgesOnNodes",value:function(){var t=this;this.allNodes.forEach((function(e){e.isHidden||e.isFiltered?e.hiddenEdgeCount=null:e.hiddenEdgeCount=t.allEdges.filter((function(t){return t.isHidden&&!t.isFiltered&&t.sourceNode===e.id})).length}))}},{key:"isNodeLive",value:function(t){return!t.isHidden&&!t.isFiltered}},{key:"isEdgeLive",value:function(t){return!t.isHidden&&!t.isFiltered}},{key:"setNodesAndEdgesHiddenStatus",value:function(t,e,n){t.forEach((function(t){return t.isHidden=n})),e.forEach((function(t){return t.isHidden=n}))}},{key:"implodeOrExplodeNode",value:function(t,e){var n=this,o=this.allEdges.filter((function(e){return e.sourceNode===t})),i=o.map((function(t){return t.targetNode})).filter((function(e){return e!==t})),r=this.allEdges.filter((function(t){return!(!i.includes(t.sourceNode)||!i.includes(t.targetNode))||(i.includes(t.sourceNode)?n.isNodeLive(n.getNodeByID(t.targetNode)):!!i.includes(t.targetNode)&&n.isNodeLive(n.getNodeByID(t.sourceNode)))})),a=[].concat(N(o),N(r)),s=i.map((function(t){return n.getNodeByID(t)}));return this.setNodesAndEdgesHiddenStatus(s,a,e),{updatedNodes:s,updatedEdges:a}}},{key:"implodeOrExplodeNodeLeafs",value:function(t,e){var n=this,o=this.allEdges.filter((function(e){return e.sourceNode===t})).filter((function(t){return!n.allEdges.find((function(e){return e.sourceNode===t.targetNode}))})),i=o.map((function(t){return t.targetNode})),r=this.allEdges.filter((function(t){return i.includes(t.sourceNode)||i.includes(t.targetNode)})),a=[].concat(N(o),N(r)),s=i.map((function(t){return n.getNodeByID(t)}));return this.setNodesAndEdgesHiddenStatus(s,a,e),{updatedNodes:s,updatedEdges:a}}},{key:"implodeOrExplodeNodeRecursive",value:function(t,e){var n=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(!o.includes(t)){o.push(t);var i=this.implodeOrExplodeNode(t,e),r=i.updatedNodes;r.forEach((function(t){return n.implodeOrExplodeNodeRecursive(t.id,e,o)}))}}},{key:"implodeOrExplodeNodeNonCircular",value:function(t,e){var n=this,o=this.allEdges.filter((function(e){return e.sourceNode===t})).filter((function(e){return 0===n.calculateEdgePathFromNodeToNode(e.targetNode,t).length})),i=o.map((function(t){return t.targetNode})),r=this.allEdges.filter((function(t){return i.includes(t.sourceNode)||i.includes(t.targetNode)})),a=[].concat(N(o),N(r)),s=i.map((function(t){return n.getNodeByID(t)}));this.setNodesAndEdgesHiddenStatus(s,a,e),i.forEach((function(t){return n.implodeOrExplodeNodeRecursive(t,e)}))}},{key:"calculateEdgePathFromNodeToNode",value:function(t,e){var n=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],r=[];if(!i.includes(t)){if(t===e)return o.push(e),o;o.push(t),i.push(t);var a=this.allEdges.filter((function(e){return e.sourceNode===t}));a.forEach((function(t){var a=N(o),s=n.calculateEdgePathFromNodeToNode(t,e,a,i);s.length>0&&(r=s)}))}return r}},{key:"edges",get:function(){return this.liveEdges}},{key:"nodes",get:function(){return this.liveNodes}}]),t}(),A=function(){function t(){var e=this;T(this,t),this.events={},Object.keys(y).forEach((function(t){e.events[y[t]]=[]}))}return O(t,[{key:"on",value:function(t,e){if(!this.events[t])throw new Error("No such event: "+t);this.events[t].push(e)}},{key:"trigger",value:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];this.events[t]&&this.events[t].forEach((function(t){t.apply(null,n)}))}}]),t}(),C=function(){function i(e,r,a){var s=this;T(this,i),this.graphContainerElement=e,this.enableZoomButtons=void 0!==a.enableZoomButtons?a.enableZoomButtons:v.ENABLE_ZOOM_BUTTONS,this.ee=r,this.ee.on(y.ZOOM_REQUESTED,(function(t,e,n){s.handleZoomRequest(t,e,n)})),this.ee.on(y.GRAPH_WILL_UNMOUNT,(function(){return s.destroy()})),this.zoom=n().scaleExtent(v.SCALE_EXTENT).on("zoom",(function(){t(s.graphContainerElement).select("g").attr("transform",o.transform)})),this.enableZoomButtons?this.initializeZoomButtons():this.zoomButtonContainer=null}return O(i,[{key:"initializeZoomButtons",value:function(){var e=this;this.zoomButtonContainer=t(this.graphContainerElement).append("div").attr("style","position:relative;");var n=this.zoomButtonContainer.append("svg").attr("filter","drop-shadow(0px 0px 2px rgba(0, 0, 0, .5))").attr("style","position:absolute;height:110px;width:34px;right:15px;bottom:30px;").append("g").attr("class","nyang-zoom-controls").attr("style","cursor:pointer;");n.append("g").on("click",(function(){e.scaleBy(1.5)})).attr("class","nyang-zoom-in").attr("transform","translate(0, 0)").append("defs").append("path").attr("id","prefix__zoomin_a").attr("d","M12.5 11h-.79l-.28-.27C12.41 9.59 13 8.11 13 6.5 13 2.91 10.09 0 6.5 0S0 2.91 0 6.5 2.91 13 6.5 13c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L17.49 16l-4.99-5zm-6-9C8.99 2 11 4.01 11 6.5S8.99 11 6.5 11 2 8.99 2 6.5 4.01 2 6.5 2zM7 4H6v2H4v1h2v2h1V7h2V6H7V4z").select((function(){return this.parentNode})).select((function(){return this.parentNode})).append("rect").attr("x","2").attr("y","2").attr("rx","5").attr("ry","5").attr("width","30").attr("height","30").attr("fill","white").select((function(){return this.parentNode})).append("g").attr("fill","none").attr("fill-rule","evenodd").attr("transform","translate(9 9)").append("mask").attr("id","prefix__zoomin_b").attr("fill","#fff").append("use").attr("xedge:href","#prefix__zoomin_a").select((function(){return this.parentNode})).select((function(){return this.parentNode})).append("g").attr("fill","#666").attr("mask","url(#prefix__zoomin_b)").append("path").attr("d","M0 0H50V50H0z").attr("transform","translate(-16 -16)"),n.append("g").on("click",(function(){e.scaleBy(1/1.5)})).attr("class","nyang-zoom-out").attr("transform","translate(0, 38)").append("defs").append("path").attr("id","prefix__zoomout_a").attr("d","M12.5 11h-.79l-.28-.27C12.41 9.59 13 8.11 13 6.5 13 2.91 10.09 0 6.5 0S0 2.91 0 6.5 2.91 13 6.5 13c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L17.49 16l-4.99-5zm-6 0C4.01 11 2 8.99 2 6.5S4.01 2 6.5 2 11 4.01 11 6.5 8.99 11 6.5 11zM4 6h5v1H4V6z").select((function(){return this.parentNode})).select((function(){return this.parentNode})).append("rect").attr("x","2").attr("y","2").attr("rx","5").attr("ry","5").attr("width","30").attr("height","30").attr("fill","white").select((function(){return this.parentNode})).append("g").attr("fill","none").attr("fill-rule","evenodd").attr("transform","translate(9 9)").append("mask").attr("id","prefix__zoomout_b").attr("fill","#fff").append("use").attr("xedge:href","#prefix__zoomout_a").select((function(){return this.parentNode})).select((function(){return this.parentNode})).append("g").attr("fill","#666").attr("mask","url(#prefix__zoomout_b)").append("path").attr("d","M0 0H50V50H0z").attr("transform","translate(-16 -16)"),n.append("g").on("click",(function(){e.resetZoom()})).attr("class","nyang-zoom-reset").attr("transform","translate(0, 76)").append("defs").append("path").attr("id","prefix__reset_a").attr("d","M15 10c.552 0 1 .448 1 1v5h-5c-.552 0-1-.448-1-1s.448-1 1-1h3v-3c0-.552.448-1 1-1zM1 10c.552 0 1 .448 1 1v3h3c.552 0 1 .448 1 1s-.448 1-1 1H0v-5c0-.552.448-1 1-1zM16 0v5c0 .552-.448 1-1 1s-1-.448-1-1V2h-3c-.552 0-1-.448-1-1s.448-1 1-1h5zM5 0c.552 0 1 .448 1 1s-.448 1-1 1H2v3c0 .552-.448 1-1 1s-1-.448-1-1V0z").select((function(){return this.parentNode})).select((function(){return this.parentNode})).append("rect").attr("x","2").attr("y","2").attr("rx","5").attr("ry","5").attr("width","30").attr("height","30").attr("fill","white").select((function(){return this.parentNode})).append("g").attr("fill","none").attr("fill-rule","evenodd").attr("transform","translate(9 9)").append("mask").attr("id","prefix__reset_b").attr("fill","#fff").append("use").attr("xedge:href","#prefix__reset_a").select((function(){return this.parentNode})).select((function(){return this.parentNode})).append("g").attr("fill","#666").attr("mask","url(#prefix__reset_b)").append("path").attr("d","M0 0H50V50H0z").attr("transform","translate(-16 -16)")}},{key:"scaleTo",value:function(e){this.zoom.scaleTo(t(this.graphContainerElement).select("svg"),e)}},{key:"scaleBy",value:function(e){this.zoom.scaleBy(t(this.graphContainerElement).select("svg").transition().duration(v.ZOOM_TIME/2),e)}},{key:"resetZoom",value:function(){var e=t(this.graphContainerElement).select("g"),n=e.attr("transform"),o=n.substring(n.indexOf("scale(")+6,n.lastIndexOf(")"));o=parseFloat(o);var i=this.graphContainerElement.clientWidth,r=this.graphContainerElement.clientHeight,a=i/((e.node().getBBox().width+2*v.ZOOM_PADDING)*o),s=r/((e.node().getBBox().height+2*v.ZOOM_PADDING)*o),c=Math.min(a,s),d=e.node().getBBox().x+e.node().getBBox().width/2,l=e.node().getBBox().y+e.node().getBBox().height/2;t(this.graphContainerElement).select("svg").transition().duration(v.ZOOM_TIME/4).call(this.zoom.scaleBy,c).transition().call(this.zoom.translateTo,d,l)}},{key:"zoomToCoordinates",value:function(n,o,i){t(this.graphContainerElement).select("svg").transition().duration(v.ZOOM_TIME).call(this.zoom.transform,e.translate(n,o).scale(i)).select("g").attr("transform","translate(".concat(n,",").concat(o,")scale(").concat(i,")"))}},{key:"handleZoomRequest",value:function(t,e,n){!t&&0!==t||!e&&0!==e||!n?this.resetZoom():this.zoomToCoordinates(t,e,n)}},{key:"destroy",value:function(){this.zoomButtonContainer&&this.zoomButtonContainer.remove()}}]),i}(),R=function(){function e(t,n,o){var i=this;T(this,e),this.showContextMenu=void 0!==o.enableContextMenu?o.enableContextMenu:v.SHOW_CONTEXT_MENU,this.customContextMenuAddons=void 0!==o.customContextMenuAddons?o.customContextMenuAddons:v.DEFAULT_CUSTOM_CONTEXT_MENU,this.graphContainerElement=t,this.ee=n,this.showContextMenu&&(this.ee.on(y.RIGHT_CLICK_ENTITY,(function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;i.buildMenu(t,e)})),this.ee.on(y.CLICK_ENTITY,(function(){i.removeContextmenu()})),this.ee.on(y.GRAPH_WILL_UNMOUNT,(function(){return i.removeContextmenu()}))),this.InitializeMenuSections()}return O(e,[{key:"buildMenu",value:function(t,e){var n=i(document.body),o=n[0],r=n[1];null===t?this.createCanvasContextMenu(null,o,r):e?this.createEdgeContextMenu(t,o,r,e):this.createNodeContextMenu(t,o,r)}},{key:"createContextMenu",value:function(e,n,o,i,r){var a=this,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:void 0;this.removeContextmenu();var c=t(this.graphContainerElement).append("div").attr("id","nyang-context-menu-container").attr("class","nyang-context-menu").style("position","fixed").style("left",i+"px").style("top",r+"px").style("display","block").append("ul").attr("class","nyang-context-menu-options");n.forEach((function(t,n){0===n?a.processSection(c,t,!1,e,s):a.processSection(c,t,!0,e,s)})),o.forEach((function(t){a.processSection(c,t,!0,e,s)}))}},{key:"processSection",value:function(t,e,n,o){var i=this,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0;n&&t.append("li").append("div").attr("class","nyang-context-menu-divider"),e.forEach((function(e){t.append("li").append("div").attr("class","nyang-context-menu-option").text((function(){return e.label})).on("click",(function(){i.removeContextmenu();var t=o&&o.data||null,n=o&&o.id||null,a=r;return e.action(t,n,a)}))}))}},{key:"createNodeContextMenu",value:function(t,e,n){var o=[this.NodeMenu,this.UniversalMenu],i=[];this.customContextMenuAddons.node&&(i=N(this.customContextMenuAddons.node)),this.createContextMenu(t,o,i,e,n)}},{key:"createEdgeContextMenu",value:function(t,e,n,o){var i=[this.EdgeMenu,this.UniversalMenu],r=[];this.customContextMenuAddons.edge&&(r=N(this.customContextMenuAddons.edge)),this.createContextMenu(t,i,r,e,n,o)}},{key:"createCanvasContextMenu",value:function(t,e,n){var o=[this.UniversalMenu],i=[];this.customContextMenuAddons.canvas&&(i=N(this.customContextMenuAddons.canvas)),this.createContextMenu(t,o,i,e,n)}},{key:"removeContextmenu",value:function(){t(this.graphContainerElement).select("#nyang-context-menu-container").remove()}},{key:"InitializeMenuSections",value:function(){var t=this;this.NodeMenu=[{label:"Select Node",action:function(e,n){t.ee.trigger(y.CLICK_ENTITY,{id:n,data:e})}}],this.EdgeMenu=[{label:"Select Edge",action:function(e,n,o){t.ee.trigger(y.CLICK_ENTITY,{id:n,data:e,direction:o})}}],this.UniversalMenu=[{label:"Reset Zoom",action:function(){t.ee.trigger(y.ZOOM_REQUESTED)}}]}}]),e}(),x=function(t,e){var n="";n="\n                /* Global Transitions */\n                .nyang * {\n                    transition: fill 0.1s, opacity 0.1s;\n                }\n\n                /* Text */\n                .nyang .multiplicity {\n                    font-size: ".concat(v.DEFAULT_MULTIPLICITY_FONT_SIZE,";\n                }     \n\n                /* Tooltip */\n                #nyang-tooltip {\n                  position: absolute;\n                  display: none;\n                  min-width: ").concat(v.TOOLTIP_MIN_WIDTH,";\n                  background: ").concat(v.TOOLTIP_BACKGROUND,";\n                  opacity: 0.8;\n                  color: ").concat(v.TOOLTIP_COLOR,";\n                  padding: 10px;\n                  text-align: center;\n                  max-width: ").concat(v.TOOLTIP_MAX_WIDTH,";\n                  word-wrap: break-word;\n                  font-size: 14px;\n                  border-radius: ").concat(v.TOOLTIP_BORDER_RADIUS,";\n                }\n\n                /* Context Menu Styles */\n                /* This is a rule for all paths unless specified otherwise */\n                .nyang path {\n                  stroke: #000;\n                  stroke-width: 2px;\n                }\n                \n                .nyang-context-menu {\n                  box-shadow: 0 4px 5px 3px rgba(0, 0, 0, 0.2);\n                  position: relative;\n                  display: block;\n                  background: #FFFFFF;\n                }\n                \n                .nyang-context-menu-options {\n                  min-width: 150px;\n                  list-style: none;\n                  padding: 0px;\n                  margin-top: 10px;\n                  margin-bottom: 10px;\n                }\n                \n                .nyang-context-menu-option {\n                  font-size: 14px;\n                  padding: 7px 20px 7px 20px;\n                  cursor: pointer;\n                }\n                \n                .nyang-context-menu-divider {\n                  width: 90%;\n                  height: 1px;\n                  margin-right: 5%;\n                  margin-left: 5%;\n                  margin-top: 8px;\n                  margin-bottom: 8px;\n                  background: #d5d5d5;\n                }\n                \n                .nyang-context-menu-option:hover {\n                  background: rgba(0, 0, 0, 0.2);\n                }\n                \n                .nyang-node-badge {\n                  fill: #505759;\n                  stroke: none !important;\n                }\n                \n                .nyang-node-edge-counter-badge-text {\n                  dominant-baseline: central;\n                  text-anchor: middle;\n                  fill: white;\n                }\n                \n                /* Search Highlighting */\n                .nyang .highlighted-node {\n                  stroke-width: ").concat(v.HIGHLIGHTING_BORDER_WIDTH,";\n                  stroke: ").concat(v.HIGHLIGHTING_BORDER_COLOR,";\n                  fill: ").concat(v.HIGHLIGHTING_COLOR,";\n                  opacity: 0.3;\n                  pointer-events: none;\n                }\n\n                .nyang .disabled {\n                    opacity: ").concat(v.DEFAULT_FADE_OPACITY,";\n                    pointer-events: none;\n                }\n\n                /* Default edge style */\n                .edge-path-default{\n                    fill: none;\n                    stroke-width: ").concat(v.DEFAULT_STROKE_WIDTH," !important;\n                    stroke-dasharray: ").concat(v.DEFAULT_EDGE_DASHARRAY," !important;\n                    stroke: ").concat(v.DEFAULT_EDGE_COLOR," !important;\n                }\n                .edge-path-default.hovered{\n                    stroke: ").concat(v.DEFAULT_LABEL_HOVER_BACKGROUND_COLOR," !important;\n                }\n                .edge-path-default.focused{\n                    stroke: ").concat(v.DEFAULT_FOCUS_COLOR," !important;\n                }\n                \n                .label-rect-default{\n                    cursor: pointer;\n                    fill: ").concat(v.DEFAULT_LABEL_BACKGROUND_COLOR,";\n                    rx: ").concat(v.DEFAULT_LABEL_BORDER_RADIUS_X,";\n                    ry: ").concat(v.DEFAULT_LABEL_BORDER_RADIUS_Y,";\n                    stroke: ").concat(v.DEFAULT_LABEL_BORDER_COLOR," !important;\n                    stroke-width: ").concat(v.DEFAULT_LABEL_BORDER_WIDTH," !important; \n                }\n                .label-rect-default:hover{\n                    fill: ").concat(v.DEFAULT_LABEL_HOVER_BACKGROUND_COLOR,";\n                    cursor: pointer;\n                }\n                .label g .label-rect-default.focused {\n                    stroke-width: ").concat(v.DEFAULT_NODE_FOCUSED_BORDER_WIDTH," !important;\n                    stroke: ").concat(v.DEFAULT_FOCUS_COLOR," !important;\n                }\n\n                .label-text-default{\n                    fill: ").concat(v.DEFAULT_LABEL_TEXT_COLOR,";\n                    dominant-baseline: central;\n                    pointer-events: none;\n                    font-family: ").concat(v.DEFAULT_FONT_FAMILY,";\n                    font-size: ").concat(v.DEFAULT_FONT_SIZE,";\n                }\n                .to:hover .label-text-default,\n                .from:hover .label-text-default{\n                    fill: ").concat(v.DEFAULT_LABEL_TEXT_HOVER_COLOR,"\n                }\n                \n                .marker-default path{\n                    fill: ").concat(v.DEFAULT_EDGE_COLOR,";\n                }\n                .marker-default path.hovered{\n                    stroke: ").concat(v.DEFAULT_LABEL_HOVER_BACKGROUND_COLOR," !important;\n                    fill: ").concat(v.DEFAULT_LABEL_HOVER_BACKGROUND_COLOR," !important;\n                    cursor: pointer;\n                }\n                .marker-default path.focused{\n                    fill: ").concat(v.DEFAULT_FOCUS_COLOR," !important;\n                    stroke: ").concat(v.DEFAULT_FOCUS_COLOR," !important;\n                }\n\n                .node, .edge, .multiplicity {\n                    animation: fadeInFromNone 0.2s ease-out;\n                }\n\n                @keyframes fadeInFromNone {\n                    0% {\n                        opacity: 0;\n                    }\n                    100% {\n                        opacity: 1;\n                    }\n                }\n\n                /* Default node values */\n                .node-default {\n                    cursor: pointer;\n                    stroke-width: ").concat(v.DEFAULT_STROKE_WIDTH,";\n                    stroke: ").concat(v.DEFAULT_NODE_STROKE_COLOR,";\n                    fill: ").concat(v.DEFAULT_NODE_COLOR,";\n                    stroke-dasharray: 0;\n                    rx: ").concat(v.DEFAULT_NODE_BORDER_RADIUS_X,";\n                    ry: ").concat(v.DEFAULT_NODE_BORDER_RADIUS_Y,";\n                }\n                .node-default:hover {\n                    fill: ").concat(v.DEFAULT_NODE_HOVER_COLOR,";\n                }\n                .node-text-default {\n                    dominant-baseline: hanging;\n                    pointer-events: none;\n                    font-family: ").concat(v.DEFAULT_FONT_FAMILY,";\n                    font-size: ").concat(v.DEFAULT_FONT_SIZE,";\n                    fill: ").concat(v.DEFAULT_NODE_TEXT_COLOR,";\n                }\n                .node:hover .node-text-default {\n                    fill: ").concat(v.DEFAULT_NODE_TEXT_HOVER_COLOR,";\n                }\n                .nyang .node-default.focused {\n                    stroke: ").concat(v.DEFAULT_FOCUS_COLOR," !important;\n                    stroke-width: ").concat(v.DEFAULT_NODE_FOCUSED_BORDER_WIDTH," !important;\n                }\n                "),t&&t.nodes&&t.nodes.forEach((function(t){n="\n                ".concat(n,"\n                .node-").concat(t.id," {\n                    cursor: pointer;\n                    ").concat(t.borderWidth?"stroke-width:".concat(t.borderWidth,";"):"","\n                    ").concat(t.borderColor?"stroke:".concat(t.borderColor,";"):"","\n                    ").concat(t.backgroundColor?"fill:".concat(t.backgroundColor,";"):"","\n                    ").concat(t.dotted?"stroke-dasharray:".concat(v.DEFAULT_NODE_DOTTED_DASHARRAY,";"):"","\n                    ").concat(t.borderRadiusX?"rx:".concat(t.borderRadiusX,";"):"","\n                    ").concat(t.borderRadiusY?"ry:".concat(t.borderRadiusY,";"):"","\n                    ").concat(t.filter?"filter:".concat(t.filter,";"):"","\n                }\n                .node-").concat(t.id,":hover {\n                    ").concat(t.borderHoverWidth?"stroke-width:".concat(t.borderHoverWidth,";"):"","\n                    ").concat(t.borderHoverColor?"stroke:".concat(t.borderHoverColor,";"):"","\n                    ").concat(t.backgroundHoverColor?"fill:".concat(t.backgroundHoverColor,";"):"","\n                    ").concat(t.hoverFilter?"filter:".concat(t.hoverFilter,";"):"","                    \n                }\n                .node-text-").concat(t.id," {\n                    font-family: ").concat(v.DEFAULT_FONT_FAMILY,";\n                    font-size: ").concat(v.DEFAULT_FONT_SIZE,";\n                    dominant-baseline: hanging;\n                    pointer-events: none;\n                    ").concat(t.textColor?"fill:".concat(t.textColor,";"):"",";\n                }\n                .node:hover .node-text-").concat(t.id," {\n                    ").concat(t.textHoverColor?"fill:".concat(t.textHoverColor,";"):"","\n                }\n                .nyang .node-").concat(t.id,".focused {\n                    ").concat(t.borderFocusedWidth?"stroke-width:".concat(t.borderFocusedWidth,";"):"","\n                    ").concat(t.borderFocusedColor?"stroke:".concat(t.borderFocusedColor," !important"):"","\n                    ").concat(t.backgroundFocusedColor?"fill:".concat(t.backgroundFocusedColor,";"):"","\n                    ").concat(t.focusedFilter?"filter:".concat(t.focusedFilter," !important;"):"","\n                }\n                .nyang .node-").concat(t.id,".focused .node-text-").concat(t.id," {\n                    ").concat(t.textFocusedColor?"fill:".concat(t.textFocusedColor,";"):"","\n                }\n                ")})),t&&t.edges&&t.edges.forEach((function(t){n="\n                ".concat(n,"\n                .edge-path-").concat(t.id,"{\n                    fill: none !important;\n                    stroke-width: ").concat(v.DEFAULT_STROKE_WIDTH," !important;\n                    stroke-dasharray: ").concat(t.dotted?v.DEFAULT_EDGE_DOTTED_DASHARRAY:v.DEFAULT_EDGE_DASHARRAY," !important;\n                    ").concat(t.color?"stroke:".concat(t.color," !important;"):"","\n                }\n                .edge-path-").concat(t.id,".hovered{\n                    ").concat(t.hoverColor?"stroke:".concat(t.hoverColor," !important;"):"","\n                }\n                .edge-path-").concat(t.id,".focused{\n                    ").concat(t.focusedColor?"stroke:".concat(t.focusedColor," !important;"):"","\n                } \n                .label-rect-").concat(t.id,"{\n                    cursor: pointer;\n                    ").concat(t.labelBackgroundColor?"fill:".concat(t.labelBackgroundColor,";"):"","\n                    ").concat(t.borderRadiusX?"rx:".concat(t.borderRadiusX,";"):"","\n                    ").concat(t.borderRadiusY?"ry:".concat(t.borderRadiusY,";"):"","\n                    ").concat(t.labelBorderColor?"stroke:".concat(t.labelBorderColor,";"):"","\n                    ").concat(t.labelBorderWidth?"stroke-width: ".concat(t.labelBorderWidth,";"):""," \n                    ").concat(t.filter?"filter:".concat(t.filter,";"):"","\n                }\n                .label-rect-").concat(t.id,":hover{\n                    ").concat(t.hoverColor?"fill:".concat(t.hoverColor,";"):"","\n                    ").concat(t.labelHoverBorderColor?"stroke:".concat(t.labelHoverBorderColor," !important;"):"","\n                    ").concat(t.labelHoverBorderWidth?"stroke-width:".concat(t.labelHoverBorderWidth," !important;"):"","\n                    ").concat(t.hoverFilter?"filter:".concat(t.hoverFilter,";"):"","\n                }\n                .label g .label-rect-").concat(t.id,".focused {\n                    ").concat(t.labelFocusedBorderWidth?"stroke-width:".concat(t.labelFocusedBorderWidth," !important;"):"","\n                    ").concat(t.focusedColor?"stroke:".concat(t.focusedColor,";"):"","\n                    ").concat(t.focusedFilter?"filter:".concat(t.focusedFilter," !important;"):"","\n                    ").concat(t.labelFocusedBorderColor?"stroke:".concat(t.labelFocusedBorderColor," !important;"):"","\n                }\n                .label-text-").concat(t.id,"{\n                    ").concat(t.labelTextColor?"fill:".concat(t.labelTextColor,";"):"",";\n                    dominant-baseline: central;\n                    pointer-events: none;\n                    font-family: ").concat(v.DEFAULT_FONT_FAMILY,";\n                    font-size: ").concat(v.DEFAULT_FONT_SIZE,";\n                }\n                .to:hover .label-text-").concat(t.id,",\n                .from:hover .label-text-").concat(t.id,"{\n                    ").concat(t.labelTextHoverColor?"fill:".concat(t.labelTextHoverColor,";"):"","\n                }\n                .marker-").concat(t.id," path.hovered{\n                    ").concat(t.hoverColor?"stroke:".concat(t.hoverColor,";"):"","\n                    ").concat(t.hoverColor?"fill:".concat(t.hoverColor,";"):"","\n                    cursor: pointer;\n                }\n                .marker-").concat(t.id," path{\n                    ").concat(t.arrowColor?"fill:".concat(t.arrowColor,";"):"","\n                }\n                .marker-").concat(t.id," path.focused{\n                    ").concat(t.focusedColor?"fill:".concat(t.focusedColor,";"):"","\n                    ").concat(t.focusedColor?"stroke:".concat(t.focusedColor,";"):"","\n                }\n                ")}));var o=document.createElement("style");o.type="text/css",o.id=e,o.appendChild(document.createTextNode(n)),document.getElementsByTagName("head")[0].appendChild(o)},U=function t(e,n,o,i,r,a,s){var c=Date.now()-r;if(c>a)e.style.removeProperty(n);else{var d=o+(i-o)*(c/a),l=s?s(d):d;e.style[n]=l,setTimeout((function(){return t(e,n,o,i,r,a,s)}),1)}},S=function(){function e(t,n,o){var i=this;T(this,e),this.graphContainerElement=t,this.ee=n,this.ee.on(y.CLICK_ENTITY,(function(t){t&&i.setElementFocus(t.id,t.direction)})),this.ee.on(y.CLICK_ENTITY,(function(t){t||i.removeAllEntityFocus()})),this.ee.on(y.HIGHLIGHT_NODE_REQUESTED,(function(t){i.highlightNode(t.map((function(t){return t.id})))})),this.ee.on(y.DISABLE_NODES_REQUESTED,(function(t){i.disableNodes(t)})),this.ee.on(y.CLEAR_DISABLE_NODES_REQUESTED,(function(){i.clearDisabled()})),this.enableOnionOnFocus="boolean"==typeof o.enableOnionOnFocus?o.enableOnionOnFocus:v.ENABLE_ONION_ON_FOCUS,this.focusedOnionNumberOfLayers=o.focusedOnionNumberOfLayers?o.focusedOnionNumberOfLayers:v.DEFAULT_ONION_FOCUSED_LAYERS,this.focusedOnionBaseColor=o.focusedOnionBaseColor?o.focusedOnionBaseColor:v.DEFAULT_ONION_FOCUSED_COLOR,this.focusedOnionLayerSize=o.focusedOnionLayerSize?o.focusedOnionLayerSize:v.DEFAULT_ONION_FOCUSED_SIZE,this.writeHighlightFilters()}return O(e,[{key:"writeHighlightFilters",value:function(){var e=this,n=function(n,o,i){t(e.graphContainerElement).select("defs").append("filter").attr("id",n).append("feDropShadow").attr("dx","0").attr("dy","0").attr("stdDeviation",o).attr("flood-opacity",i)};n("shadow-filter",3,.5),n("shadow-dark-filter",5,.5)}},{key:"setElementFocus",value:function(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;t&&("from"===n?e=!0:"to"===n&&(e=!1),this.removeAllEntityFocus(),this.toggleEntityFocusByID(t,e))}},{key:"removeAllEntityFocus",value:function(){r(".focused").classed("focused",!1),this.enableOnionOnFocus&&r(".onion-clone").attr("class","removing").transition().duration(v.DEFAULT_ONION_ANIMATION_TIME).style("transform","scale(0.8)").remove()}},{key:"toggleEntityFocusByID",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return this.toggleNodeEntityFocus(t)||this.toggleEdgeEntityFocus(t,e)}},{key:"toggleNodeEntityFocus",value:function(e){var n=t("[id='".concat(e,"']"));if(n.node()){var o=n.node(),i=o.parentElement.children;return r(N(i)).classed("focused",!n.classed("focused")),this.enableOnionOnFocus&&this.toggleOnionBorder(o,this.focusedOnionLayerSize,this.focusedOnionBaseColor,this.focusedOnionNumberOfLayers),!0}return!1}},{key:"toggleOnionBorder",value:function(e,n,o){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,r=e.parentElement.children,a=!1;if(Array.from(r).forEach((function(e){e.classList.contains("onion-clone")&&(a=!0,t(e).attr("class",null).transition().duration(v.DEFAULT_ONION_ANIMATION_TIME).style("transform","scale(0.8)").remove())})),!a){var s=e,c=0;getComputedStyle(e).strokeWidth&&"rgba(0, 0, 0, 0)"!==getComputedStyle(e).stroke&&(c+=parseInt(getComputedStyle(e).strokeWidth.substring(0,getComputedStyle(e).strokeWidth.length-2))/2);for(var d=1;d<i+1;d++){var l=e.cloneNode();l.removeAttribute("class"),l.removeAttribute("id"),l.removeAttribute("style"),e.hasAttribute("r")&&l.setAttribute("r",parseInt(e.getAttribute("r"))+d*n+c),e.hasAttribute("width")&&(l.setAttribute("width",parseInt(e.getAttribute("width"))+d*(2*n)+c),l.setAttribute("height",parseInt(e.getAttribute("height"))+d*(2*n)+c),l.setAttribute("x",parseInt(e.getAttribute("x"))-d*n-c/2),l.setAttribute("y",parseInt(e.getAttribute("y"))-d*n-c/2),getComputedStyle(e).rx&&(l.style.rx=parseInt(getComputedStyle(e).rx.substring(0,getComputedStyle(e).rx.length-2))*(d+1)+"px"),getComputedStyle(e).ry&&(l.style.ry=parseInt(getComputedStyle(e).ry.substring(0,getComputedStyle(e).ry.length-2))*(d+1)+"px")),l.style.pointerEvents="none",l.style.fill=o,l.setAttribute("opacity",.5/d),l.setAttribute("class","onion-clone"),e.parentElement.insertBefore(l,s),U(l,"transform",e.getBoundingClientRect().width/l.getBoundingClientRect().width,1,Date.now(),v.DEFAULT_ONION_ANIMATION_TIME*d,(function(t){return"scale(".concat(t,")")})),s=l}return!0}return!1}},{key:"toggleEdgeEntityFocus",value:function(e,n){var o=t("#label".concat(e).concat(n?"from":"to"));if(o){var i=o.select("rect:not(.removing)"),a=i.classed("focused");return i.classed("focused",!a),this.enableOnionOnFocus&&this.toggleOnionBorder(i.node(),this.focusedOnionLayerSize,this.focusedOnionBaseColor,this.focusedOnionNumberOfLayers),r('marker[id$="'.concat(e).concat(n?"inverse":"",'"]')).select("path").classed("focused",!a),r('[class*="'.concat(e).concat(n?"inverse ":" ",'"]')).selectAll("path, text").classed("focused",!a),!0}return!1}},{key:"highlightNode",value:function(t){r(".node").filter((function(e){return t.includes(e.id)})).append("circle").attr("r",50).classed("highlighted-node",!0).transition().duration(v.HIGHLIGHT_TIME).ease(a).style("transform","scale(5)").transition().duration(v.HIGHLIGHT_TIME_REMOVE).remove()}},{key:"disableNodes",value:function(t){r(".node").filter((function(e){return t.includes(e.id)})).classed("disabled",!0),r(".edge").filter((function(e){return t.includes(e.sourceNode)||t.includes(e.targetNode)})).classed("disabled",!0),r(".label").filter((function(e){return t.includes(e.sourceNode)||t.includes(e.targetNode)})).classed("disabled",!0)}},{key:"clearDisabled",value:function(){r(".disabled").classed("disabled",!1)}}]),e}(),F=function(){function e(t,n){var o=this;T(this,e),this.graphContainerElement=t,this.ee=n,this.tooltip=this.initializeTooltip(),this.ee.on(y.MOUSE_OVER_NODE,(function(t){o.showTooltip(t)})),this.ee.on(y.MOUSE_LEFT_NODE,(function(){o.hideTooltip()})),this.ee.on(y.GRAPH_WILL_UNMOUNT,(function(){return o.destroy()}))}return O(e,[{key:"initializeTooltip",value:function(){return t(this.graphContainerElement).append("div").attr("id","nyang-tooltip")}},{key:"showTooltip",value:function(t){var e=i(document.documentElement);this.tooltip.style("left",e[0]-window.pageXOffset+"px").style("top",e[1]+20-window.pageYOffset+"px").style("display","inline-block").style("position","fixed").html(t.name)}},{key:"hideTooltip",value:function(){this.tooltip.style("display","none")}},{key:"destroy",value:function(){this.tooltip.remove()}}]),e}(),b=function(){function e(t,n,o){T(this,e),this.graphContainerElement=t,this.enableGrid=void 0!==o.enableGrid?o.enableGrid:v.ENABLE_GRID,this.enableSecondaryGrid=void 0!==o.enableSecondaryGrid&&o.enableSecondaryGrid,this.ee=n,this.enableGrid?this.initializeGrid():this.enableSecondaryGrid&&this.initializeAlternativeGrid()}return O(e,[{key:"initializeGrid",value:function(){var e=t(this.graphContainerElement).select("svg").select("g").select("defs").append("pattern").attr("id","grid").attr("width",60).attr("height",60).attr("patternUnits","userSpaceOnUse");e.append("path").attr("d","M 60 0 L 0 0 0 60").attr("style","fill: none; stroke: #dedede; stroke-width: 1; stroke-dasharray: 2;"),this.createLine(e,0,0,0,2),this.createLine(e,0,0,2,0),this.createLine(e,60,60,58,60),this.createLine(e,60,60,60,58),this.createLine(e,0,58,0,60),this.createLine(e,0,60,2,60),this.createLine(e,58,0,60,0),this.createLine(e,60,0,60,2),t(this.graphContainerElement).select("svg").insert("rect",":first-child").attr("width","100%").attr("height","100%").attr("fill","url(#grid)")}},{key:"initializeAlternativeGrid",value:function(){t(this.graphContainerElement).select("svg").select("g").select("defs").append("pattern").attr("id","grid").attr("width",60).attr("height",60).attr("patternUnits","userSpaceOnUse").append("path").attr("d","M 60 0 L 0 0 0 60").attr("style","fill: none; stroke: #a0a0a0; stroke-width: 1; stroke-dasharray: 2;"),t(this.graphContainerElement).select("svg").insert("rect",":first-child").attr("width","100%").attr("height","100%").attr("fill","url(#grid)")}},{key:"createLine",value:function(t,e,n,o,i){t.append("line").attr("style","stroke: #a0a0a0;stroke-width:0.5;").attr("x1",e).attr("y1",n).attr("x2",o).attr("y2",i)}}]),e}(),k=s().x((function(t){return t.x})).y((function(t){return t.y})).curve(c),M=s().x((function(t){return t.x})).y((function(t){return t.y})).curve(c.tension(-1)),H=function(t){(t%=360)<0&&(t+=360);var e=2*Math.PI*t/360;return e<0&&(e+=2*Math.PI),e},G=function(t){var e=Math.floor((t.multiEdgeIndex-t.multiEdgeCount%2)/2)+1,n=t.multiEdgeCount%2*15,o=0;switch(e){case 1:o=20+n;break;case 2:o=45+n}return o},P=function(t,e,n){var o=e.x-t.x,i=-(e.y-t.y),r=o,a=n/Math.sqrt(i*i+r*r);return{x:i*a,y:r*a}},B={calculateCurvePoint:function(t,e,n){var o=G(n),i=e.x-t.x,r=e.y-t.y,a=t.x+i/2,s=t.y+r/2,c=P(t,e,o);return n.source.index<n.target.index&&(c.x=-c.x,c.y=-c.y),n.multiEdgeIndex%2!=0&&(c.x=-c.x,c.y=-c.y),{x:a+c.x,y:s+c.y}},calculateIntersection:function(t,e,n){var o=e.x-t.x,i=e.y-t.y,r=e.radius;if("rectangle"===e.shape)if(Math.abs(i/o)<=e.height/e.width){var a=i/(o/(e.width/2));r=Math.sqrt(Math.pow(e.width/2,2)+a*a)}else{var s=o/(i/(e.height/2));r=Math.sqrt(Math.pow(e.height/2,2)+s*s)}var c=Math.sqrt(o*o+i*i),d=(c-(r+n))/c;return{x:o*d+t.x,y:i*d+t.y}},calculateMultiEdgeDistance:G,calculateNormalVector:P,calculateRadian:H,curveFunction:k,loopFunction:M,calculateSelfEdgePath:function(t){var e=t.source,n=360/t.selfEdgeCount,o=Math.min(60,.8*n),i=H(n*t.selfEdgeIndex),r=H(n*t.selfEdgeIndex+o),a=Math.cos(i)*e.radius,s=Math.sin(i)*e.radius,c=Math.cos(r)*e.radius,d=Math.sin(r)*e.radius,l={x:e.x+a,y:e.y+s},u={x:e.x+c,y:e.y+d},E=(a+c)/2*2.5,h=(s+d)/2*2.5,f={x:e.x+E,y:e.y+h};return t.curvePoint=f,M([l,f,u])},calculateLabelAngle:function(t,e){var n=t.x-e.x,o=t.y-e.y,i=Math.atan2(o,n)*(180/Math.PI);return(i+=180)>90&&i<270&&(i-=180),i}},w=function(){function e(t,n,o){var i=this;T(this,e),this.enableFadeOnHover=void 0!==o.enableFadeOnHover?o.enableFadeOnHover:v.DEFAULT_FADE_ON_HOVER,this.showMultiplicity=!0,this.enableMultiLineNodeLabels=void 0!==o.enableMultiLineNodeLabels?o.enableMultiLineNodeLabels:v.DEFAULT_NODE_TEXT_MULTILINE,this.rotateLabels=void 0!==o.rotateLabels?o.rotateLabels:v.ROTATE_LABELS,this.rootG=t,this.nodes=[],this.edges=[],this.listeningForTick=!1,this.pinMode=!1,this.ee=n,this.ee.on(y.TOGGLE_MULTIPLICITY_REQUESTED,(function(){i.showMultiplicity=!i.showMultiplicity,i.updateMultiplicityCounters(i.edges)})),this.ee.on(y.NODE_PIN_MODE_TOGGLED,(function(t){return i.pinMode=t})),this.ee.on(y.DATASTORE_UPDATED,(function(t,e){i.nodes=t,i.edges=e,i.updateMarkers(e),i.updateEdges(e),i.updateLabels(e),i.updateMultiplicityCounters(e),i.updateNodes(t),i.attachEntityClickListeners(),i.ee.trigger(y.DOM_PROCESSOR_FINISHED,t,e)})),this.ee.on(y.ENGINE_TICK,(function(){i.listeningForTick&&i.tick()})),this.ee.on(y.GRAPH_HAS_MOUNTED,(function(){i.listeningForTick=!0}))}return O(e,[{key:"updateMarkers",value:function(t){var e=this,n=this.rootG.select("defs");n.selectAll("marker").remove(),t.forEach((function(t){e.drawMarker(n,t,!1),t.nameFrom&&e.drawMarker(n,t,!0)}))}},{key:"updateEdges",value:function(t){var e=this,n=this.rootG.select("#edge-container").selectAll(".edge").data(t,(function(t){return t.id}));n.exit().remove(),n.enter().append("g").attr("class",(function(t){return e.getMarkerId(t,!0)+" "+e.getMarkerId(t,!1)})).classed("edge",!0).append("path").attr("class",(function(t){return"edge-path-".concat(t.type?t.type:"default")})).attr("marker-end",(function(t){return"url(#"+e.getMarkerId(t,!1)+")"})).attr("marker-start",(function(t){return t.nameFrom?"url(#"+e.getMarkerId(t,!0)+")":""})),this.edgePath=this.rootG.select("#edge-container").selectAll(".edge path")}},{key:"updateMultiplicityCounters",value:function(e){var n=this;if(this.showMultiplicity){var o=this.rootG.select("#multiplicity-container").selectAll(".multiplicity").data(e,(function(t){return t.id}));o.exit().remove(),o.enter().append("g").classed("multiplicity",!0).filter((function(t){return t.multiplicityTo||t.multiplicityFrom})).each((function(e,o,i){e.multiplicityFrom&&n.drawMultiplicity(t(i[o]),"from"),e.multiplicityTo&&n.drawMultiplicity(t(i[o]),"to")}))}else this.rootG.select("#multiplicity-container").selectAll(".multiplicity").remove();this.activeMultiplicities=this.rootG.select("#multiplicity-container").selectAll(".multiplicity").selectAll("g")}},{key:"updateNodes",value:function(e){var n=this,i=this.rootG.select("#node-container").selectAll(".node").data(e,(function(t){return t.id}));i.exit().remove(),i.enter().append("g").attr("class","node").call(d().on("start",(function(t){n.ee.trigger(y.NODE_DRAG_START,t),t.animating=!0,t.fx=t.x,t.fy=t.y})).on("drag",(function(t){n.ee.trigger(y.NODE_DRAG_DRAGGED,t),t.fx=o.x,t.fy=o.y})).on("end",(function(t){delete t.animating,n.pinMode||(t.fx=null,t.fy=null),n.updateNodes(n.nodes),n.ee.trigger(y.NODE_DRAG_ENDED,t)}))).each((function(e,o,i){var r=t(i[o]);n.drawNode(r,e)})),e.forEach((function(e){if(t("[id='badge-".concat(e.id,"-hidden-edge-counter']")).remove(),e.hiddenEdgeCount){var o=t("[id='".concat(e.id,"']")).select((function(){return this.parentNode}));n.drawNodeCollapsedEdgeCounter(o,e)}})),e.forEach((function(e){if(t("[id='pin-".concat(e.id,"']")).remove(),e.fx&&e.fy&&!e.animating){var o=t("[id='".concat(e.id,"']")).select((function(){return this.parentNode}));n.drawPin(o,e)}})),this.nodeElements=this.rootG.select("#node-container").selectAll(".node")}},{key:"updateLabels",value:function(e){var n=this,o=this.rootG.select("#label-container").selectAll(".label").data(e,(function(t){return t.id}));o.exit().remove(),o.enter().append("g").classed("label",!0).filter((function(t){return t.nameTo||t.nameFrom})).each((function(e,o,i){e.nameFrom&&n.drawLabel(t(i[o]),e,"from"),e.nameTo&&n.drawLabel(t(i[o]),e,"to")})),this.labels=this.rootG.select("#label-container").selectAll(".label").selectAll("g")}},{key:"getEdgeDistance",value:function(t){return(void 0!==t.target.radius?t.target.radius:0)+(void 0!==t.source.radius?t.source.radius:0)+t.edgeDistance}},{key:"getMarkerId",value:function(t,e){return(t.type?t.type:"normal")+t.id+(e?"inverse":"")}},{key:"drawMarker",value:function(t,e,n){t.append("marker").attr("id",this.getMarkerId(e,n)).attr("viewBox","0 -8 14 16").attr("refX",n?0:12).attr("refY",0).attr("markerWidth",12).attr("markerHeight",12).attr("markerUnits","userSpaceOnUse").attr("orient","auto").attr("class",(e.type?e.type:"normal")+"Marker").attr("class","marker-"+(e.type?e.type:"default")).append("path").attr("d",(function(){return n?"M12,-8L0,0L12,8Z":"M0,-8L12,0L0,8Z"}))}},{key:"drawLabel",value:function(t,e,n){var o=t.append("g").attr("id","label"+e.id+n).classed(n,!0);this.drawLabelRect(o,e,n);var i=o.append("text").attr("class",(function(){return"label-text-".concat(e.type?e.type:"default")})).attr("text-anchor","middle");this.drawLabelText(i,e,n)}},{key:"drawLabelRect",value:function(t,e,n){var o=this,i="to"===n?e.nameToWidth:e.nameFromWidth;t.append("rect").attr("class",(function(){return"label-rect-".concat(e.type?e.type:"default")})).attr("x",-i/2).attr("y",-v.LABEL_HEIGHT/2).attr("width",i).attr("height",v.LABEL_HEIGHT).on("mouseenter",(function(t){o.labelMouseEnter(t,n)})).on("mouseleave",(function(t){o.labelMouseLeave(t,n)}))}},{key:"drawLabelText",value:function(t,e,n){t.append("tspan").text((function(){var t="to"===n?e.nameToWidth:e.nameFromWidth;return("to"===n?e.nameTo:"from"===n?e.nameFrom:e.nameTo?e.nameTo:e.nameFrom).toString().truncate(t)}))}},{key:"labelMouseEnter",value:function(t,e){var n=this,o="from"===e;r("marker#"+this.getMarkerId(t,o)).select("path").classed("hovered",!0),r("."+this.getMarkerId(t,o)).selectAll("path, text").classed("hovered",!0),setTimeout((function(){var e=r("marker#"+n.getMarkerId(t,o)).select("path");e._groups[0].length>0&&e.classed("hovered")&&(n.handleHoverEvent(t,"enter"),n.rootG.selectAll(".label").sort((function(e,n){return e.id===t.id&&n.id!==t.id?1:e.id!==t.id&&n.id===t.id?-1:e.id-n.id})))}),250)}},{key:"labelMouseLeave",value:function(t,e){this.handleHoverEvent(t,"leave");var n="from"===e;r("marker#"+this.getMarkerId(t,n)).select("path").classed("hovered",!1),r("."+this.getMarkerId(t,n)).selectAll("path, text").classed("hovered",!1)}},{key:"drawMultiplicity",value:function(t,e){var n=this;t.append("g").attr("class",(function(t){return n.getMarkerId(t,"to"===e)})).classed(e,!0).append("text").attr("text-anchor","middle").text((function(t){return"to"===e?t.multiplicityTo:t.multiplicityFrom}))}},{key:"drawNode",value:function(t,e){var n=this,o=t.append("g"),i=0,r=0,a="middle";switch(e.shape){case"circle":t.insert("circle","g").attr("r",(function(t){return t.radius})).attr("class","node-".concat(e.type?e.type:"default")).attr("id",e.id),e.icon&&(this.drawIcon(o,e.icon),r=v.DEFAULT_NODE_ICON_PADDING);break;case"layeredCircle":t.insert("circle","g").attr("r",(function(t){return t.radius})).attr("style","stroke-width:2;fill:#fff;stroke:#000;stroke-dasharray:0;pointer-events:none;").attr("id",e.id),t.insert("circle","g").attr("r",(function(t){return t.radius-4})).attr("class","node-".concat(e.type?e.type:"default")),e.icon&&(this.drawIcon(o,e.icon),r=v.DEFAULT_NODE_ICON_PADDING);break;case"rectangle":if(t.insert("rect","g").attr("x",(function(t){return-t.width/2})).attr("y",(function(t){return-t.height/2})).attr("width",(function(t){return t.width})).attr("height",(function(t){return t.height})).attr("class","node-".concat(e.type?e.type:"default")).attr("id",e.id),e.icon){var s=this.drawIcon(t,e.icon);s.attr("y",-v.DEFAULT_NODE_ICON_SIZE/2),s.attr("x",-t.node().getBBox().width/2+v.ADDITIONAL_TEXT_SPACE),i+=-t.node().getBBox().width/2+v.ADDITIONAL_TEXT_SPACE+v.DEFAULT_NODE_ICON_SIZE+v.DEFAULT_NODE_ICON_PADDING,a="start"}break;default:console.error("NO SHAPE FOUND FOR NODE")}if(t.on("mouseenter",(function(t){n.handleHoverEvent(t,"enter")})).on("mouseleave",(function(t){n.handleHoverEvent(t,"leave")})).on("mousemove",(function(t){n.ee.trigger(y.MOUSE_OVER_NODE,t)})).on("mouseout",(function(t){n.ee.trigger(y.MOUSE_LEFT_NODE,t)})),this.drawTextBlock(o,a),this.enableMultiLineNodeLabels){var c=e.name,d=c.truncate(e.maxTextWidth);if(d.length<c.length&&d.lastIndexOf(" ")>-1){d=d.substring(0,d.lastIndexOf(" "));var l=c.substring(d.length+1).truncate(e.maxTextWidth);l.length+d.length+1<c.length&&(l=l.substring(0,l.length-3)+"..."),this.drawTextline(o.select("text"),d,e.type?e.type:"default",o.node().getBBox().height+r),this.drawTextline(o.select("text"),l,e.type?e.type:"default",o.node().getBBox().height)}else d.length<c.length&&(d=d.substring(0,d.length-3)+"..."),this.drawTextline(o.select("text"),d,e.type?e.type:"default",o.node().getBBox().height+r)}else this.drawTextline(o.select("text"),e.name.truncate(e.maxTextWidth),e.type?e.type:"default",o.node().getBBox().height+r);o.attr("transform","translate(".concat(i,", ").concat(-o.node().getBBox().height/2-o.node().getBBox().y,")"))}},{key:"drawIcon",value:function(t,e){return t.append("image").attr("href",e).attr("width",v.DEFAULT_NODE_ICON_SIZE).attr("height",v.DEFAULT_NODE_ICON_SIZE).attr("x",-v.DEFAULT_NODE_ICON_SIZE/2).attr("style","pointer-events: none;")}},{key:"drawTextBlock",value:function(t,e){t.append("text").attr("text-anchor",e||"middle")}},{key:"drawTextline",value:function(t,e,n,o){t.append("tspan").attr("class","node-text-".concat(n)).attr("x",0).attr("y",o).text(e)}},{key:"drawNodeCollapsedEdgeCounter",value:function(t,e){var n,o,i,r,a,s="".concat(e.hiddenEdgeCount),c=s.width(),d=(e.radius?2*e.radius:e.height)/2,l=(e.radius?2*e.radius:e.width)/2,u=c+16;t.append("g").attr("id","badge-"+e.id+"-hidden-edge-counter").attr("style","pointer-events:none;").attr("transform","translate(".concat(l," ").concat(d,")")).append("path").attr("d",(n=-u/2,o=-15,i=u,r=30,a=10,"M".concat(n,",").concat(o,"\n\t\t\t\th").concat(i-a,"\n\t\t\t\tq").concat(a,",0 ").concat(a,",").concat(a,"\n\t\t\t\tv").concat(r-2*a,"\n\t\t\t\tq0,").concat(a," ").concat(-a,",").concat(a,"\n\t\t\t\th").concat(2*a-i,"\n\t\t\t\tq").concat(-a,",0 ").concat(-a,",").concat(-a,"\n\t\t\t\tz"))).attr("class","nyang-node-badge").select((function(){return this.parentNode})).append("text").attr("class","nyang-node-edge-counter-badge-text").append("tspan").attr("style","font-size:".concat(14,";")).text("".concat(s))}},{key:"drawPin",value:function(t,e){var n,o,i,r,a=-(e.radius?2*e.radius:e.height)/2,s=(e.radius?2*e.radius:e.width)/2;t.append("g").attr("id","pin-"+e.id).attr("style","pointer-events:none;").attr("transform","translate(".concat(s-12.5," ").concat(a,")")).append("path").attr("d",(n=-12.5,o=25,i=25,r=10,"M".concat(r,",").concat(n,"\n\t\t\t\th").concat(o-2*r,"\n\t\t\t\tq").concat(r,",0 ").concat(r,",").concat(r,"\n\t\t\t\tv").concat(i-2*r,"\n\t\t\t\tq0,").concat(r," ").concat(-r,",").concat(r,"\n\t\t\t\th").concat(-o+r,"\n\t\t\t\tv").concat(-i+r,"\n\t\t\t\tq0,").concat(-r," ").concat(r,",").concat(-r,"\n\t\t\t\tz"))).attr("class","nyang-node-badge").select((function(){return this.parentNode})).append("path").attr("d","M24.715,261.811c-5.492,0-10.645-2.133-14.521-6.01c-8.011-8.017-8.011-21.054-0.006-29.064    l70.375-70.372L38.51,113.785c-7.073-7.179-7.928-18.303-2.039-26.466c0.855-1.184,21.314-28.839,58.964-28.839    c2.224,0,4.492,0.101,6.756,0.295L180.62,3.597c8.103-5.729,20.081-4.48,26.863,2.796l44.675,48.037    c6.919,7.436,7.319,19.006,0.926,26.906l-55.882,69.151c1.979,23.759,1.052,63.069-23.901,77.725    c-7.959,4.666-18.578,3.26-25.021-3.282l-38.837-39.316l-70.206,70.183C35.365,259.678,30.208,261.811,24.715,261.811z").attr("style","fill:#ffffff;transform: scale(0.05) translate(120px, -130px);stroke:#ffffff;")}},{key:"attachEntityClickListeners",value:function(){var t=this,e=null;this.rootG.selectAll(".node").on("click",(function(n){o.stopPropagation(),clearTimeout(e),e=setTimeout((function(){t.ee.trigger(y.CLICK_ENTITY,{id:n.id,data:n.data})}),v.DOUBLE_CLICK_THRESHOLD)})).on("dblclick",(function(n){o.stopPropagation(),clearTimeout(e),t.ee.trigger(y.DBL_CLICK_ENTITY,{id:n.id,data:n.data})})).on("contextmenu",(function(e){o.preventDefault(),o.stopPropagation(),t.ee.trigger(y.RIGHT_CLICK_ENTITY,e)})),this.rootG.selectAll(".label .from").on("click",(function(n){o.stopPropagation(),clearTimeout(e),e=setTimeout((function(){t.ee.trigger(y.CLICK_ENTITY,{id:n.id,data:n.data,direction:"from"})}),v.DOUBLE_CLICK_THRESHOLD)})).on("dblclick",(function(e){o.stopPropagation(),t.ee.trigger(y.DBL_CLICK_ENTITY,{id:e.id,data:e.data,direction:"from"})})).on("contextmenu",(function(e){o.preventDefault(),o.stopPropagation(),t.ee.trigger(y.RIGHT_CLICK_ENTITY,e,"from")})),this.rootG.selectAll(".label .to").on("click",(function(n){o.stopPropagation(),clearTimeout(e),e=setTimeout((function(){t.ee.trigger(y.CLICK_ENTITY,{id:n.id,data:n.data,direction:"to"})}),v.DOUBLE_CLICK_THRESHOLD)})).on("dblclick",(function(e){o.stopPropagation(),t.ee.trigger(y.DBL_CLICK_ENTITY,{id:e.id,data:e.data,direction:"from"})})).on("contextmenu",(function(e){o.preventDefault(),o.stopPropagation(),t.ee.trigger(y.RIGHT_CLICK_ENTITY,e,"to")}))}},{key:"handleHoverEvent",value:function(t,e){if(this.ee.trigger(y.HOVER_ENTITY,{eventType:e,id:t.id,data:t.data}),this.enableFadeOnHover&&!t.sourceNode){var n=this.edges.filter((function(e){return e.sourceNode===t.id||e.targetNode===t.id})),o=n.reduce((function(t,e){return t.push(e.targetNode),t.push(e.sourceNode),t}),[]);o.push(t.id);var i="enter"===e?""+v.DEFAULT_FADE_OPACITY:"1";r(".node").filter((function(t){return void 0===o.find((function(e){return e===t.id}))})).transition().duration(v.FADE_TIME).ease(l).style("opacity",i),r(".edge").filter((function(t){return void 0===n.find((function(e){return e.id===t.id}))})).transition().duration(v.FADE_TIME).ease(l).style("opacity",i),r(".label").filter((function(t){return void 0===n.find((function(e){return e.id===t.id}))})).transition().duration(v.FADE_TIME).ease(l).style("opacity",i)}}},{key:"tick",value:function(){var e=this;this.nodeElements.attr("transform",(function(t){return"translate("+t.x+","+t.y+")"})),this.edgePath.attr("d",(function(t){if(t.source.x===t.target.x&&t.source.y===t.target.y&&t.source.id!==t.target.id)return"";if(t.source===t.target)return B.calculateSelfEdgePath(t);e.rotateLabels&&(t.angle=B.calculateLabelAngle(t.source,t.target));var n=B.calculateIntersection(t.target,t.source,1),o=B.calculateIntersection(t.source,t.target,1),i=B.calculateCurvePoint(n,o,t);return t.curvePoint=i,B.curveFunction([B.calculateIntersection(t.curvePoint,t.source,1),i,B.calculateIntersection(t.curvePoint,t.target,1)])})),this.activeMultiplicities.attr("transform",(function(e){var n;n=t(this).classed("to")?B.calculateIntersection(e.curvePoint,e.source,v.MULTIPLICITY_HDISTANCE):B.calculateIntersection(e.curvePoint,e.target,v.MULTIPLICITY_HDISTANCE);var o=B.calculateNormalVector(e.curvePoint,e.source,v.MULTIPLICITY_VDISTANCE);return e.source.index<e.target.index&&(o.x=-o.x,o.y=-o.y),"translate("+(n.x+o.x)+","+(n.y+o.y)+")"})),this.labels.attr("transform",(function(e){if(e.source.x===e.target.x&&e.source.y===e.target.y&&e.source.id!==e.target.id)return"";var n=t(this),o=e.curvePoint.x,i=e.curvePoint.y;return e.nameFrom&&(n.classed("to")?i+=v.LABEL_HEIGHT/2+1:n.classed("from")&&(i-=v.LABEL_HEIGHT/2+1)),e.angle?"translate("+o+","+i+") rotate("+e.angle+")":"translate("+o+","+i+")"}))}}]),e}(),W=function(){function e(t,n,o,i){var r=this;T(this,e),this.graphContainerElement=t,this.style=o,this.ee=n,this.ee.on(y.GRAPH_WILL_UNMOUNT,(function(){return r.destroy()})),this.zoomHandler=new C(this.graphContainerElement,this.ee,i),this.contextMenu=new R(this.graphContainerElement,this.ee,i),this.tooltip=new F(this.graphContainerElement,this.ee),this.stylesID=("A"+Math.random()).replace(".","").replace(",",""),x(this.style,this.stylesID),this.rootG=this.initializeDOM(),this.highlighter=new S(this.graphContainerElement,this.ee,i),this.grid=new b(this.graphContainerElement,this.ee,i),this.DOMProcessor=new w(this.rootG,this.ee,i)}return O(e,[{key:"initializeDOM",value:function(){var e=this,n=t(this.graphContainerElement).insert("svg","*").attr("class","nyang").classed("svgGraph",!0).attr("width","100%").attr("height","100%").on("click",(function(){o.stopPropagation(),e.ee.trigger(y.CLICK_ENTITY,null)})).on("contextmenu",(function(){o.preventDefault(),o.stopPropagation(),e.ee.trigger(y.RIGHT_CLICK_ENTITY,null)})).call(this.zoom).on("dblclick.zoom",null).append("g");return n.append("defs"),n.append("g").attr("id","edge-container"),n.append("g").attr("id","label-container"),n.append("g").attr("id","multiplicity-container"),n.append("g").attr("id","node-container"),n}},{key:"destroy",value:function(){this.rootG.select("#edge-container").selectAll(".edge").remove(),this.rootG.select("#multiplicity-container").selectAll(".multiplicity").remove(),this.rootG.select("#node-container").selectAll(".node").remove(),this.rootG.select("#label-container").selectAll(".label").remove(),t(this.graphContainerElement).select("svg").remove(),t("#".concat(this.stylesID)).remove()}},{key:"zoom",get:function(){return this.zoomHandler.zoom}},{key:"context",get:function(){return this.contextMenu}},{key:"width",get:function(){return this.graphContainerElement.offsetWidth}},{key:"height",get:function(){return this.graphContainerElement.offsetHeight}}]),e}(),Y=function(){function t(e,n,o){var i=this;T(this,t),this.ee=o,this.ee.on(y.DOM_PROCESSOR_FINISHED,(function(t,e){i.updateSimulation(t,e),i.ee.trigger(y.ENGINE_UPDATE_FINISHED,t,e)})),this.ee.on(y.NODE_DRAG_START,(function(){i.stop(),i.target(.5)})),this.ee.on(y.NODE_DRAG_DRAGGED,(function(){i.restart()})),this.ee.on(y.NODE_DRAG_ENDED,(function(){i.target(0)})),this.ee.on(y.CLICK_ENTITY,(function(){i.alpha(0)})),this.ee.on(y.ENGINE_LAYOUT_REQUESTED,(function(t,e,n,o,r){i.createLayout(t,e,n,o,r)})),this.ee.on(y.ENGINE_LAYOUT_RESET_REQUESTED,(function(t,e){i.resetLayout(t,e),i.alpha(2),i.restart()})),this.ee.on(y.IMPLODE_EXPLODE_REQUESTED,(function(){i.alpha(.5),i.restart()})),this.ee.on(y.IMPLODE_EXPLODE_LEAFS_REQUESTED,(function(){i.alpha(.5),i.restart()})),this.ee.on(y.IMPLODE_EXPLODE_RECURSIVE_REQUESTED,(function(){i.alpha(.5),i.restart()})),this.ee.on(y.IMPLODE_EXPLODE_NON_CIRCULAR_REQUESTED,(function(){i.alpha(.5),i.restart()})),this.ee.on(y.TOGGLE_MULTIPLICITY_REQUESTED,(function(){i.alpha(.01),i.restart()})),this.ee.on(y.GRAPH_WILL_UNMOUNT,(function(){return i.stop()})),this.forceCenterX=e,this.forceCenterY=n,this.simulation=this.initializeSimulation()}return O(t,[{key:"initializeSimulation",value:function(){var t=this;return u().force("charge",E().strength(v.CHARGE)).force("center",h(this.forceCenterX,this.forceCenterY)).force("y",f(0).strength(v.GRAVITY)).force("x",_(0).strength(v.GRAVITY)).nodes([]).force("link",g().links([]).distance((function(e){return t.getEdgeDistance(e)})).strength(v.EDGE_STRENGTH)).on("tick",(function(){t.ee.trigger(y.ENGINE_TICK)}))}},{key:"updateSimulation",value:function(t,e){var n=this;this.simulation.nodes(t),this.simulation.force("link",g().links(e).distance((function(t){return n.getEdgeDistance(t)})).strength(v.EDGE_STRENGTH)),this.simulation.alpha(1).restart()}},{key:"stop",value:function(){this.simulation.stop()}},{key:"restart",value:function(){this.simulation.restart()}},{key:"alpha",value:function(t){this.simulation.alpha(t)}},{key:"target",value:function(t){this.simulation.alphaTarget(t)}},{key:"decay",value:function(t){this.simulation.alphaDecay(t)}},{key:"createLayout",value:function(t,e,n,o,i){var r,a=this;i&&(t=t.sort((function(t,e){return i(t,e)}))),r=o?t.map((function(t){return o(t.data)})):t.map((function(t){return t[n]}));var s=N(new Set(r)),c=Math.ceil(Math.sqrt(s.length)),d=0,l=0,u=s.map((function(){return l===c&&(l=0,d+=1),[d,(l+=1)-1]})),h=p().domain(N(Array(c).keys())).range([30,2e3]),T=p().domain(N(Array(c).keys())).range([30,2e3]);this.simulation.force("x",_((function(t){var e;return e=o?o(t.data):t[n],h(u[s.indexOf(e)][1])}))).force("y",f((function(t){var e;return e=o?o(t.data):t[n],T(u[s.indexOf(e)][0])}))).force("link",g().links(e).distance((function(t){return a.getEdgeDistance(t)})).strength(0)).force("charge",E().strength(-800)).alpha(1).restart()}},{key:"resetLayout",value:function(t,e){var n=this;this.simulation.force("y",f(0).strength(v.GRAVITY)).force("x",_(0).strength(v.GRAVITY)).force("link",g().links(e).distance((function(t){return n.getEdgeDistance(t)})).strength(v.EDGE_STRENGTH)).force("charge",E().strength(v.CHARGE))}},{key:"getEdgeDistance",value:function(t){return(void 0!==t.target.radius?t.target.radius:0)+(void 0!==t.source.radius?t.source.radius:0)+t.edgeDistance}}]),t}(),X=function(){function t(e,n,o){var i=this;T(this,t),this._options=Object.assign.apply(Object,[{}].concat(o)),this._style=n.style?JSON.parse(JSON.stringify(n.style)):{},this._ee=new A,this._options.entityClickedListener&&this._ee.on(y.CLICK_ENTITY,this._options.entityClickedListener),this._options.entityDoubleClickedListener&&this._ee.on(y.DBL_CLICK_ENTITY,this._options.entityDoubleClickedListener),this._options.entityHoveredListener&&this._ee.on(y.HOVER_ENTITY,this._options.entityHoveredListener),this._UI=new W(e,this._ee,this._style,o),this._datastore=new m(n.nodes,n.edges,this._ee,this._style,this._options),this._engine=new Y(this._UI.width/2,this._UI.height/2,this._ee),this._ee.on(y.GRAPH_HAS_MOUNTED,(function(){i._UI.zoomHandler.scaleTo(v.INITIAL_SCALE)})),this._ee.trigger(y.GRAPH_HAS_MOUNTED)}return O(t,[{key:"setFilters",value:function(t){this._ee.trigger(y.DATA_FILTER_REQUESTED,t)}},{key:"getFilters",value:function(){return this._datastore.filters}},{key:"resetAllFilters",value:function(){this._ee.trigger(y.DATA_FILTER_RESET_REQUESTED)}},{key:"toggleMultiplicity",value:function(){this._ee.trigger(y.TOGGLE_MULTIPLICITY_REQUESTED)}},{key:"highlight",value:function(t,e,n){if(!(t&&e||n))throw new Error("No attribute, value or filterfunction provided");var o=this._datastore.nodes.filter((function(o){return n?n(o.data):o[t].toUpperCase().includes(e.toUpperCase())}));this._ee.trigger(y.HIGHLIGHT_NODE_REQUESTED,o)}},{key:"disable",value:function(t,e,n){if(!(t&&e||n))throw new Error("No attribute, value or filterfunction provided");var o=this._datastore.nodes.filter((function(o){return n?n(o.data):o[t].toUpperCase().includes(e.toUpperCase())})).map((function(t){return t.id}));this._ee.trigger(y.DISABLE_NODES_REQUESTED,o)}},{key:"clearDisable",value:function(){this._ee.trigger(y.CLEAR_DISABLE_NODES_REQUESTED)}},{key:"resetZoom",value:function(){this._ee.trigger(y.ZOOM_REQUESTED,null,null,null)}},{key:"zoomToNode",value:function(t){var e=this._datastore.nodes.find((function(e){return e.id===t}));if(!e)throw new Error("No such node: "+t);var n=this._UI.graphContainerElement.offsetWidth/2,o=this._UI.graphContainerElement.offsetHeight/2,i=1.5*-e.x+n,r=1.5*-e.y+o;this._ee.trigger(y.ZOOM_REQUESTED,i,r,1.5)}},{key:"setMatrixLayout",value:function(t,e,n){this._ee.trigger(y.ENGINE_LAYOUT_REQUESTED,this._datastore.nodes,this._datastore.edges,t,e,n)}},{key:"resetLayout",value:function(){this._ee.trigger(y.ENGINE_LAYOUT_RESET_REQUESTED,this._datastore.nodes,this._datastore.edges)}},{key:"centerNode",value:function(t){var e=this,n=this._datastore.nodes.find((function(e){return e.id===t}));if(n){var o=this._UI.rootG,i=o.node().getBBox().x+o.node().getBBox().width/2,r=o.node().getBBox().y+o.node().getBBox().height/2;n.targetX=i,n.targetY=r,n.sourceX=n.x,n.sourceY=n.y,this._datastore.entityProcessor.animateNodePositions([n]).then((function(){e._datastore.entityProcessor.pinNode(n,i,r),e._UI.DOMProcessor.updateNodes(e._UI.DOMProcessor.nodes),e._engine.alpha(1),e._engine.restart()}))}}},{key:"setPinMode",value:function(t){this._ee.trigger(y.NODE_PIN_MODE_TOGGLED,t)}},{key:"pinGraph",value:function(){var t=this,e=this._datastore.nodes.map((function(e){return t._datastore.entityProcessor.pinNode(e,e.x,e.y)}));Promise.all(e).then((function(){t._UI.DOMProcessor.updateNodes(t._UI.DOMProcessor.nodes)}))}},{key:"resetAllPins",value:function(){var t=this;this._datastore.allNodes.forEach((function(e){return t._datastore.entityProcessor.unPinNode(e)})),this._UI.DOMProcessor.updateNodes(this._UI.DOMProcessor.nodes),this._engine.alpha(1),this._engine.restart(1)}},{key:"implodeOrExplodeNode",value:function(t,e){this._ee.trigger(y.IMPLODE_EXPLODE_REQUESTED,t,e)}},{key:"implodeOrExplodeNodeLeafs",value:function(t,e){this._ee.trigger(y.IMPLODE_EXPLODE_LEAFS_REQUESTED,t,e)}},{key:"implodeOrExplodeNodeRecursive",value:function(t,e){this._ee.trigger(y.IMPLODE_EXPLODE_RECURSIVE_REQUESTED,t,e)}},{key:"implodeOrExplodeNodeNonCircular",value:function(t,e){this._ee.trigger(y.IMPLODE_EXPLODE_NON_CIRCULAR_REQUESTED,t,e)}},{key:"updateDataset",value:function(t){this._ee.trigger(y.DATA_UPDATE_REQUESTED,t.nodes,t.edges)}},{key:"saveGraphAsJSON",value:function(t){if(this._datastore.allNodes||this._datastore.allEdges){var e={style:this._style,nodes:t?this._datastore.liveNodes:this._datastore.allNodes,edges:t?this._datastore.liveEdges:this._datastore.allEdges},n=new Blob([JSON.stringify(e,null,null)],{type:"text/json"}),o=document.createElement("a");o.download="nyang.json",o.href=window.URL.createObjectURL(n),o.dataset.downloadurl=["text/json",o.download,o.href].join(":"),o.click()}}},{key:"destroyGraph",value:function(){var t=this;this._ee.trigger(y.GRAPH_WILL_UNMOUNT),Object.keys(this).forEach((function(e){delete t[e]}))}}]),t}();export default X;
