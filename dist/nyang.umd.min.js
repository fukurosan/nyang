/** @preserve @license @cc_on
 * ----------------------------------------------------------
 * nyang version 0.0.1
 * Not your average network graph 
 * https://github.com/fukurosan/nyang
 * Copyright (c) 2021 Fukurosan
 * All Rights Reserved. MIT License
 * https://mit-license.org/
 * ----------------------------------------------------------
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("d3")):"function"==typeof define&&define.amd?define(["d3"],t):(e="undefined"!=typeof globalThis?globalThis:e||self).NYANG=t(e.d3)}(this,(function(e){"use strict";function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function o(e,t,o){return t&&n(e.prototype,t),o&&n(e,o),e}function i(e){return function(e){if(Array.isArray(e))return r(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return r(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}var a=Object.freeze({ENABLE_ZOOM_BUTTONS:!1,ENABLE_GRID:!1,DEFAULT_FADE_ON_HOVER:!1,DEFAULT_USE_CONTEXT_MENU:!0,SHOW_CONTEXT_MENU:!0,DEFAULT_CUSTOM_CONTEXT_MENU:{},ZOOM_PADDING:40,LABEL_HEIGHT:28,LABEL_WIDTH:80,EDGE_LABEL_PADDING:20,FIXED_EDGE_LABEL_WIDTH:!0,ROTATE_LABELS:!1,MULTIPLICITY_HDISTANCE:20,MULTIPLICITY_VDISTANCE:10,DEFAULT_STROKE_WIDTH:2,DEFAULT_FONT_FAMILY:"Helvetica, Arial, sans-serif",DEFAULT_FONT_SIZE:"12px",DEFAULT_FADE_OPACITY:.3,DEFAULT_FOCUS_COLOR:"#2A6D91",DEFAULT_EDGE_DOTTED_DASHARRAY:3,DEFAULT_EDGE_DASHARRAY:0,DEFAULT_EDGE_COLOR:"#000000",DEFAULT_ARROW_COLOR:"#000000",DEFAULT_MULTIPLICITY_FONT_SIZE:"10px",DEFAULT_EDGE_WIDTH:"2px",DEFAULT_LABEL_TEXT_COLOR:"#000000",DEFAULT_LABEL_TEXT_HOVER_COLOR:"#ffffff",DEFAULT_LABEL_BACKGROUND_COLOR:"#ffffff",DEFAULT_LABEL_HOVER_BACKGROUND_COLOR:"#2A6D91",DEFAULT_LABEL_BORDER_RADIUS_X:"4px",DEFAULT_LABEL_BORDER_RADIUS_Y:"4px",DEFAULT_LABEL_BORDER_WIDTH:"0px",DEFAULT_LABEL_BORDER_COLOR:"transparent",DEFAULT_NODE_DOTTED_DASHARRAY:8,DEFAULT_NODE_STROKE_COLOR:"transparent",DEFAULT_NODE_STROKE_HOVER_COLOR:"transparent",DEFAULT_NODE_COLOR:"#ffffff",DEFAULT_NODE_HOVER_COLOR:"#2A6D91",DEFAULT_NODE_FOCUSED_COLOR:"#ffffff",DEFAULT_NODE_TEXT_COLOR:"#000000",DEFAULT_NODE_TEXT_HOVER_COLOR:"#ffffff",DEFAULT_NODE_TEXT_FOCUSED_COLOR:"#000000",DEFAULT_NODE_BORDER_RADIUS_X:"0px",DEFAULT_NODE_BORDER_RADIUS_Y:"0px",DEFAULT_NODE_FOCUSED_BORDER_WIDTH:"4px",DEFAULT_NODE_HOVER_BORDER_WIDTH:"2px",DEFAULT_RECTANGLE_MAX_HEIGHT:20,DEFAULT_RECTANGLE_MAX_WIDTH:60,DEFAULT_CIRCLE_NODE_RADIUS:50,DEFAULT_NODE_ICON_SIZE:16,DEFAULT_NODE_ICON_PADDING:8,DEFAULT_NODE_TEXT_MULTILINE:!1,DEFAULT_NODE_FILTER:!1,DEFAULT_NODE_HOVER_FILTER:!1,DEFAULT_NODE_FOCUSED_FILTER:!1,TOOLTIP_MIN_WIDTH:"80px",TOOLTIP_MAX_WIDTH:"150px",TOOLTIP_BACKGROUND:"black",TOOLTIP_COLOR:"white",TOOLTIP_BORDER_RADIUS:"2px",HIGHLIGHTING_BORDER_WIDTH:"0px",HIGHLIGHTING_BORDER_COLOR:"transparent",HIGHLIGHTING_COLOR:"#009ADE",ENABLE_ONION_ON_FOCUS:!0,DEFAULT_ONION_FOCUSED_LAYERS:2,DEFAULT_ONION_FOCUSED_COLOR:"#B6D5DB",DEFAULT_ONION_FOCUSED_SIZE:10,DEFAULT_ONION_ANIMATION_TIME:80,DEFAULT_VISIBLE_EDGE_DISTANCE:350,ADDITIONAL_TEXT_SPACE:20,DOUBLE_CLICK_THRESHOLD:300,FADE_TIME:300,ZOOM_TIME:1e3,HIGHLIGHT_TIME:1e3,HIGHLIGHT_TIME_REMOVE:1e3,IMPLOSION_EXPLOSION_ANIMATION_TIME:200,EDGE_STRENGTH:.7,GRAVITY:.06,CHARGE:-2e3,SCALE_EXTENT:[.1,4],INITIAL_SCALE:.3});String.prototype.width=function(t){t||(t="text");var n=e.select("body").append("div").attr("class",t).attr("style","font-size:12px; position: absolute;float: left;white-space: nowrap;visibility: hidden;").attr("id","width-test").text(this),o=document.getElementById("width-test").offsetWidth;return n.remove(),o},String.prototype.truncate=function(e,t){if(e-=a.ADDITIONAL_TEXT_SPACE,isNaN(e)||e<=0)return this;for(var n,o,i=this,r=this.length;!((n=i.width(t))<=e);)o=n/e,r=Math.floor(r/o),i=i.substring(0,r);return this.length>r?this.substring(0,r-3)+"...":this};var s=Object.freeze({CLICK_ENTITY:"ENTITY_CLICKED_EVENT",DBL_CLICK_ENTITY:"ENTITY_DBL_CLICKED_EVENT",HOVER_ENTITY:"ENTITY_HOVER_EVENT",RIGHT_CLICK_ENTITY:"ENTITY_RIGHT_CLICKED_EVENT",NODE_DRAG_START:"NODE_DRAG_STARTED_EVENT",NODE_DRAG_DRAGGED:"NODE_DRAG_DRAGGED_EVENT",NODE_DRAG_ENDED:"NODE_DRAG_ENDED_EVENT",MOUSE_OVER_NODE:"MOUSE_MOVED_OVER_NODE_EVENT",MOUSE_LEFT_NODE:"MOUSE_MOVED_OUTSIDE_NODE_EVENT",NODE_FIXATION_REQUESTED:"NODE_FIXATION_REQUESTED",DATA_UPDATE_REQUESTED:"DATA_UPDATE_REQUESTED",DATASTORE_UPDATED:"LIVE_DATA_UPDATED_EVENT",DOM_PROCESSOR_FINISHED:"DOM_PROCESSOR_FINISHED",ENGINE_UPDATE_FINISHED:"ENGINE_UPDATE_FINISHED_EVENT",DATA_FILTER_REQUESTED:"DATA_FILTER_REQUESTED_EVENT",DATA_FILTER_RESET_REQUESTED:"DATA_FILTER_RESET_REQUESTED_EVENT",IMPLODE_EXPLODE_REQUESTED:"IMPLODE_OR_EXPLODE_ENTITIES_REQUESTED_EVENT",IMPLODE_EXPLODE_LEAFS_REQUESTED:"IMPLODE_OR_EXPLODE_ENTITIES_LEAFS_REQUESTED_EVENT",IMPLODE_EXPLODE_RECURSIVE_REQUESTED:"IMPLODE_OR_EXPLODE_ENTITIES_RECURSIVE_REQUESTED_EVENT",IMPLODE_EXPLODE_NON_CIRCULAR_REQUESTED:"IMPLODE_OR_EXPLODE_ENTITIES_NON_CIRCULAR_REQUESTED_EVENT",ZOOM_REQUESTED:"ZOOM_WAS_REQUESTED_EVENT",HIGHLIGHT_NODE_REQUESTED:"HIGHLIGHT_NODE_REQUESTED_EVENT",DISABLE_NODES_REQUESTED:"DISABLE_NODES_REQUESTED_EVENT",CLEAR_DISABLE_NODES_REQUESTED:"CLEAR_DISABLE_NODES_REQUESTED_EVENT",TOGGLE_MULTIPLICITY_REQUESTED:"TOGGLE_MULTIPLICITY_REQUEST_EVENT",ENGINE_TICK:"ENGINE_TICK_EVENT",ENGINE_LAYOUT_REQUESTED:"ENGINE_LAYOUT_REQUESTED_EVENT",ENGINE_LAYOUT_RESET_REQUESTED:"ENGINE_LAYOUT_RESET_REQUESTED_EVENT",GRAPH_HAS_MOUNTED:"GRAPH_HAS_MOUNTED",GRAPH_WILL_UNMOUNT:"GRAPH_WILL_UNMOUNT"}),c=function(){function e(n,o,i){var r=this;t(this,e),this.style=o,this.fixedEdgeLabelWidth=void 0!==i.enableFixedEdgeLabelWidth?i.enableFixedEdgeLabelWidth:a.FIXED_EDGE_LABEL_WIDTH,this.edgeLabelWidth=i.edgeLabelWidth?i.edgeLabelWidth:a.LABEL_WIDTH,this.maxEdgeLabelWidth=i.maxEdgeLabelWidth?i.maxEdgeLabelWidth:2*a.LABEL_WIDTH,this.ee=n,this.ee.on(s.NODE_FIXATION_REQUESTED,(function(e,t,n){r.repositionNode(e,t,n)}))}return o(e,[{key:"executePreProcessor",value:function(e,t){this.updateEdgeNodeIDs(t,e),this.updateEdgeDistances(t),this.updateEdgeLabelWidths(t),this.updateEdgeCounters(t),this.updateNodeParameters(e)}},{key:"repositionNode",value:function(e,t,n){e.fx=t,e.fy=n}},{key:"updateEdgeNodeIDs",value:function(e,t){e.forEach((function(e){e.source=t.findIndex((function(t){return t.id===e.sourceNode})),e.target=t.findIndex((function(t){return t.id===e.targetNode})),void 0!==e.source&&void 0!==e.target||console.error("Broken Edge",e)}))}},{key:"updateEdgeDistances",value:function(e){var t=this;e.forEach((function(e){if(t.style&&t.style.edges){var n=t.style.edges.find((function(t){return t.id===e.type}));n&&n.edgeDistance?e.edgeDistance=n.edgeDistance:e.edgeDistance=a.DEFAULT_VISIBLE_EDGE_DISTANCE}else e.edgeDistance=a.DEFAULT_VISIBLE_EDGE_DISTANCE}))}},{key:"updateEdgeLabelWidths",value:function(e){var t=this;e.forEach((function(e){if(t.fixedEdgeLabelWidth)e.nameToWidth=t.edgeLabelWidth,e.nameFromWidth=t.edgeLabelWidth;else{if(e.nameTo){var n=e.nameTo.width();n=n<t.maxEdgeLabelWidth?n:t.maxEdgeLabelWidth,e.nameToWidth=n+a.EDGE_LABEL_PADDING}else e.nameToWidth=t.edgeLabelWidth;if(e.nameFrom){var o=e.nameTo.width();o=o<t.maxEdgeLabelWidth?o:t.maxEdgeLabelWidth,e.nameFromWidth=o+a.EDGE_LABEL_PADDING}else e.nameFromWidth=t.edgeLabelWidth}}))}},{key:"updateEdgeCounters",value:function(e){e.forEach((function(t){var n=0;if(isNaN(t.multiEdgeCount)){var o=[];for(e.forEach((function(e){(t.source===e.source&&t.target===e.target||t.target===e.source&&t.source===e.target)&&o.push(e)})),n=0;n<o.length;n++)o[n].multiEdgeCount=o.length,o[n].multiEdgeIndex=n}if(isNaN(t.selfEdgeCount)){var i=[];for(e.forEach((function(e){t.source===e.source&&t.target===e.target&&i.push(e)})),n=0;n<i.length;n++)i[n].selfEdgeCount=i.length,i[n].selfEdgeIndex=n}}))}},{key:"updateNodeParameters",value:function(e){var t=this;e.forEach((function(e){if(t.style&&t.style.nodes){var n=t.style.nodes.find((function(t){return t.id===e.type}));if(n)switch(n.shape){case"circle":case"layeredCircle":e.radius=n.radius?n.radius:a.DEFAULT_CIRCLE_NODE_RADIUS,e.maxTextWidth=2*e.radius,e.shape=n.shape;break;case"rectangle":e.height=n.maxHeight?n.maxHeight:a.DEFAULT_RECTANGLE_MAX_HEIGHT,e.width=n.maxWidth?n.maxWidth:a.DEFAULT_RECTANGLE_MAX_WIDTH,e.maxTextWidth=n.maxWidth?e.icon?n.maxWidth-a.DEFAULT_NODE_ICON_SIZE-a.ADDITIONAL_TEXT_SPACE/2-a.DEFAULT_NODE_ICON_PADDING:n.maxWidth:a.DEFAULT_RECTANGLE_MAX_WIDTH,e.shape=n.shape;break;default:e.radius=n.radius?n.radius:a.DEFAULT_CIRCLE_NODE_RADIUS,e.maxTextWidth=2*e.radius,e.shape=n.shape}else e.radius=a.DEFAULT_CIRCLE_NODE_RADIUS,e.maxTextWidth=2*e.radius,e.shape="circle"}else e.radius=a.DEFAULT_CIRCLE_NODE_RADIUS,e.maxTextWidth=2*e.radius,e.shape="circle"}))}},{key:"animateNodePositions",value:function(e){return new Promise((function(t){e.forEach((function(e){e.originalFx=e.fx,e.originalFy=e.fy,e.fx=e.x,e.fy=e.y})),function n(o,i){var r=Date.now()-o;if(r>i)e.forEach((function(e){delete e.targetX,delete e.targetY,delete e.sourceX,delete e.sourceY,delete e.fx,delete e.fy,e.originalFx&&(e.fx=e.originalFx,delete e.originalFx),e.originalFy&&(e.fy=e.originalFy,delete e.originalFy)})),t();else{var a=r/i;e.filter((function(e){return e.targetX&&e.targetY})).forEach((function(e){e.fx=e.sourceX+(e.targetX-e.sourceX)*a,e.fy=e.sourceY+(e.targetY-e.sourceY)*a})),setTimeout((function(){return n(o,i)}),1)}}(Date.now(),a.IMPLOSION_EXPLOSION_ANIMATION_TIME)}))}}]),e}(),l=function(){function e(n,o,i,r,a){var l=this;t(this,e),this.allNodes=JSON.parse(JSON.stringify(n)),this.allEdges=JSON.parse(JSON.stringify(o)),this.liveNodes=this.allNodes,this.liveEdges=this.allEdges,this.filters={nodes:[],edges:[]},this.ee=i,this.ee.on(s.DATA_UPDATE_REQUESTED,(function(e,t){return l.updateDataset(e,t)})),this.ee.on(s.GRAPH_HAS_MOUNTED,(function(){l.entityProcessor.executePreProcessor(l.nodes,l.edges),l.ee.trigger(s.DATASTORE_UPDATED,l.nodes,l.edges)})),this.ee.on(s.DATA_FILTER_REQUESTED,(function(e){l.setFilters(e),l.applyFilters(),l.updateNumberOfHiddenEdgesOnNodes(),l.updateLiveData()})),this.ee.on(s.DATA_FILTER_RESET_REQUESTED,(function(){l.resetAllFilters(),l.applyFilters(),l.updateNumberOfHiddenEdgesOnNodes(),l.updateLiveData()})),this.ee.on(s.IMPLODE_EXPLODE_REQUESTED,(function(e,t){l.implodeOrExplodeNode(e,t),l.updateNumberOfHiddenEdgesOnNodes(),l.implodeExplodedNodesAnimation(e,t)})),this.ee.on(s.IMPLODE_EXPLODE_LEAFS_REQUESTED,(function(e,t){l.implodeOrExplodeNodeLeafs(e,t),l.updateNumberOfHiddenEdgesOnNodes(),l.implodeExplodedNodesAnimation(e,t)})),this.ee.on(s.IMPLODE_EXPLODE_RECURSIVE_REQUESTED,(function(e,t){l.implodeOrExplodeNodeRecursive(e,t),l.updateNumberOfHiddenEdgesOnNodes(),l.implodeExplodedNodesAnimation(e,t)})),this.ee.on(s.IMPLODE_EXPLODE_NON_CIRCULAR_REQUESTED,(function(e,t){l.implodeOrExplodeNodeNonCircular(e,t),l.updateNumberOfHiddenEdgesOnNodes(),l.implodeExplodedNodesAnimation(e,t)})),this.entityProcessor=new c(this.ee,r,a),this.updateEdgeIDs(),this.applyFilters(),this.updateNumberOfHiddenEdgesOnNodes()}return o(e,[{key:"implodeExplodedNodesAnimation",value:function(e,t){var n=this,o=this.getNodeByID(e);this.stageNodePositions(t?null:o.x,t?null:o.y,t?o.x:null,t?o.y:null),t?this.entityProcessor.animateNodePositions(this.allNodes).then((function(){n.updateLiveData()})):(this.updateLiveData(),this.entityProcessor.animateNodePositions(this.allNodes))}},{key:"updateEdgeIDs",value:function(){this.allEdges.forEach((function(e,t){void 0===e.id&&(e.id=t)}))}},{key:"updateDataset",value:function(e,t){var n=JSON.parse(JSON.stringify(e)),o=JSON.parse(JSON.stringify(t));this.allNodes=n,this.allEdges=o,this.updateEdgeIDs(),this.applyFilters(),this.updateNumberOfHiddenEdgesOnNodes(),this.updateLiveData()}},{key:"getNodeByID",value:function(e){return this.allNodes.find((function(t){return t.id===e}))}},{key:"getEdgeByID",value:function(e){return this.allEdges.find((function(t){return t.id===e}))}},{key:"resetAllFilters",value:function(){this.filters={nodes:[],edges:[]}}},{key:"setFilters",value:function(e){var t=[],n=[];e.forEach((function(e){if("node"===e.entityType)t.push({attribute:e.attribute,value:e.value,function:e.filterFunction});else{if("edge"!==e.entityType)throw new Error("No such entity type for filters:",e.entityType);n.push({attribute:e.attribute,value:e.value,function:e.filterFunction})}})),this.filters.nodes=t,this.filters.edges=n}},{key:"applyFilters",value:function(){var e=this;this.allNodes.forEach((function(t){var n=!1;e.filters.nodes.forEach((function(e){n||(e.filterFunction?n=e.filterFunction(t.data):t[e.attribute]===e.value&&(n=!0))})),t.isFiltered=n})),this.allEdges.forEach((function(t){var n=!1;e.filters.edges.forEach((function(e){n||(e.filterFunction?n=e.filterFunction(t.data):t[e.attribute]===e.value&&(n=!0))}));var o=e.allNodes.find((function(e){return t.sourceNode===e.id&&!e.isFiltered})),i=e.allNodes.find((function(e){return t.targetNode===e.id&&!e.isFiltered}));o&&i||(n=!0),t.isFiltered=n}))}},{key:"stageNodePositions",value:function(e,t,n,o){var i=this;if(e||n)if(n&&!e)this.allNodes.filter((function(e){return!i.isNodeLive(e)&&i.liveNodes.find((function(t){return t.id===e.id}))})).forEach((function(e){e.targetX=n,e.targetY=o,e.sourceX=e.x,e.sourceY=e.y}));else if(e&&!n){var r=this.allNodes.filter((function(e){return i.isNodeLive(e)&&!i.liveNodes.find((function(t){return t.id===e.id}))})),a={},s={};r.forEach((function(e){var t=i.allEdges.filter((function(t){return(t.targetNode===e.id||t.sourceNode===e.id)&&t.targetNode!==t.sourceNode})).map((function(t){return t.sourceNode===e.id?{node:i.getNodeByID(t.targetNode),edgeDistance:t.edgeDistance}:{node:i.getNodeByID(t.sourceNode),edgeDistance:t.edgeDistance}})).filter((function(e){return i.liveNodes.includes(e.node)})).reduce((function(e,t){return e.map((function(e){return e.node.id})).includes(t.node.id)||e.push(t),e}),[]);s[e.id]=t,1===t.length&&(Array.isArray(a[t[0].node.id])?a[t[0].node.id].push(e.id):a[t[0].node.id]=[e.id])})),r.forEach((function(n){if(n.sourceX=e+2,n.sourceY=t+2,1===s[n.id].length){var o=a[s[n.id][0].node.id].indexOf(n.id)+1,i=a[s[n.id][0].node.id].length,r=Math.floor(359/i*o);n.targetX=s[n.id][0].node.x+2*s[n.id][0].edgeDistance*Math.cos(r*Math.PI/180),n.targetY=s[n.id][0].node.y+2*s[n.id][0].edgeDistance*Math.sin(r*Math.PI/180)}else 0===s[n.id].length?(n.targetX=0,n.targetY=0):(n.targetX=s[n.id].reduce((function(e,t){return e+t.node.x}),0)/s[n.id].length,n.targetY=s[n.id].reduce((function(e,t){return e+t.node.y}),0)/s[n.id].length)}))}}},{key:"updateLiveData",value:function(){var e=this,t=this.allNodes.filter((function(t){return e.isNodeLive(t)})),n=this.allEdges.filter((function(t){return e.isEdgeLive(t)}));t.forEach((function(t){e.liveNodes.find((function(e){return e.id===t.id}))||e.liveNodes.push(t)})),this.liveNodes=this.liveNodes.filter((function(e){return t.find((function(t){return e.id===t.id}))})),n.forEach((function(t){e.liveEdges.find((function(e){return e.id===t.id}))||e.liveEdges.push(t)})),this.liveEdges=this.liveEdges.filter((function(e){return n.find((function(t){return e.id===t.id}))})),this.entityProcessor.executePreProcessor(this.nodes,this.edges),this.ee.trigger(s.DATASTORE_UPDATED,this.nodes,this.edges)}},{key:"updateNumberOfHiddenEdgesOnNodes",value:function(){var e=this;this.allNodes.forEach((function(t){t.isHidden||t.isFiltered?t.hiddenEdgeCount=null:t.hiddenEdgeCount=e.allEdges.filter((function(e){return e.isHidden&&!e.isFiltered&&e.sourceNode===t.id})).length}))}},{key:"isNodeLive",value:function(e){return!e.isHidden&&!e.isFiltered}},{key:"isEdgeLive",value:function(e){return!e.isHidden&&!e.isFiltered}},{key:"setNodesAndEdgesHiddenStatus",value:function(e,t,n){e.forEach((function(e){return e.isHidden=n})),t.forEach((function(e){return e.isHidden=n}))}},{key:"implodeOrExplodeNode",value:function(e,t){var n=this,o=this.allEdges.filter((function(t){return t.sourceNode===e})),r=o.map((function(e){return e.targetNode})).filter((function(t){return t!==e})),a=this.allEdges.filter((function(e){return!(!r.includes(e.sourceNode)||!r.includes(e.targetNode))||(r.includes(e.sourceNode)?n.isNodeLive(n.getNodeByID(e.targetNode)):!!r.includes(e.targetNode)&&n.isNodeLive(n.getNodeByID(e.sourceNode)))})),s=[].concat(i(o),i(a)),c=r.map((function(e){return n.getNodeByID(e)}));return this.setNodesAndEdgesHiddenStatus(c,s,t),{updatedNodes:c,updatedEdges:s}}},{key:"implodeOrExplodeNodeLeafs",value:function(e,t){var n=this,o=this.allEdges.filter((function(t){return t.sourceNode===e})).filter((function(e){return!n.allEdges.find((function(t){return t.sourceNode===e.targetNode}))})),r=o.map((function(e){return e.targetNode})),a=this.allEdges.filter((function(e){return r.includes(e.sourceNode)||r.includes(e.targetNode)})),s=[].concat(i(o),i(a)),c=r.map((function(e){return n.getNodeByID(e)}));return this.setNodesAndEdgesHiddenStatus(c,s,t),{updatedNodes:c,updatedEdges:s}}},{key:"implodeOrExplodeNodeRecursive",value:function(e,t){var n=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];if(!o.includes(e)){o.push(e);var i=this.implodeOrExplodeNode(e,t),r=i.updatedNodes;r.forEach((function(e){return n.implodeOrExplodeNodeRecursive(e.id,t,o)}))}}},{key:"implodeOrExplodeNodeNonCircular",value:function(e,t){var n=this,o=this.allEdges.filter((function(t){return t.sourceNode===e})).filter((function(t){return 0===n.calculateEdgePathFromNodeToNode(t.targetNode,e).length})),r=o.map((function(e){return e.targetNode})),a=this.allEdges.filter((function(e){return r.includes(e.sourceNode)||r.includes(e.targetNode)})),s=[].concat(i(o),i(a)),c=r.map((function(e){return n.getNodeByID(e)}));this.setNodesAndEdgesHiddenStatus(c,s,t),r.forEach((function(e){return n.implodeOrExplodeNodeRecursive(e,t)}))}},{key:"calculateEdgePathFromNodeToNode",value:function(e,t){var n=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],a=[];if(!r.includes(e)){if(e===t)return o.push(t),o;o.push(e),r.push(e);var s=this.allEdges.filter((function(t){return t.sourceNode===e}));s.forEach((function(e){var s=i(o),c=n.calculateEdgePathFromNodeToNode(e,t,s,r);c.length>0&&(a=c)}))}return a}},{key:"edges",get:function(){return this.liveEdges}},{key:"nodes",get:function(){return this.liveNodes}}]),e}(),d=function(){function e(){var n=this;t(this,e),this.events={},Object.keys(s).forEach((function(e){n.events[s[e]]=[]}))}return o(e,[{key:"on",value:function(e,t){if(!this.events[e])throw new Error("No such event: "+e);this.events[e].push(t)}},{key:"trigger",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];this.events[e]&&this.events[e].forEach((function(e){e.apply(null,n)}))}}]),e}(),u=function(){function n(o,i,r){var c=this;t(this,n),this.graphContainerElement=o,this.enableZoomButtons=void 0!==r.enableZoomButtons?r.enableZoomButtons:a.ENABLE_ZOOM_BUTTONS,this.ee=i,this.ee.on(s.ZOOM_REQUESTED,(function(e,t,n){c.handleZoomRequest(e,t,n)})),this.ee.on(s.GRAPH_WILL_UNMOUNT,(function(){return c.destroy()})),this.zoom=e.zoom().scaleExtent(a.SCALE_EXTENT).on("zoom",(function(){e.select(c.graphContainerElement).select("g").attr("transform",e.event.transform)})),this.enableZoomButtons?this.initializeZoomButtons():this.zoomButtonContainer=null}return o(n,[{key:"initializeZoomButtons",value:function(){var t=this;this.zoomButtonContainer=e.select(this.graphContainerElement).append("div").attr("style","position:relative;");var n=this.zoomButtonContainer.append("svg").attr("filter","drop-shadow(0px 0px 2px rgba(0, 0, 0, .5))").attr("style","position:absolute;height:110px;width:34px;right:15px;bottom:30px;").append("g").attr("class","nyang-zoom-controls").attr("style","cursor:pointer;");n.append("g").on("click",(function(){t.scaleBy(1.5)})).attr("class","nyang-zoom-in").attr("transform","translate(0, 0)").append("defs").append("path").attr("id","prefix__zoomin_a").attr("d","M12.5 11h-.79l-.28-.27C12.41 9.59 13 8.11 13 6.5 13 2.91 10.09 0 6.5 0S0 2.91 0 6.5 2.91 13 6.5 13c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L17.49 16l-4.99-5zm-6-9C8.99 2 11 4.01 11 6.5S8.99 11 6.5 11 2 8.99 2 6.5 4.01 2 6.5 2zM7 4H6v2H4v1h2v2h1V7h2V6H7V4z").select((function(){return this.parentNode})).select((function(){return this.parentNode})).append("rect").attr("x","2").attr("y","2").attr("rx","5").attr("ry","5").attr("width","30").attr("height","30").attr("fill","white").select((function(){return this.parentNode})).append("g").attr("fill","none").attr("fill-rule","evenodd").attr("transform","translate(9 9)").append("mask").attr("id","prefix__zoomin_b").attr("fill","#fff").append("use").attr("xedge:href","#prefix__zoomin_a").select((function(){return this.parentNode})).select((function(){return this.parentNode})).append("g").attr("fill","#666").attr("mask","url(#prefix__zoomin_b)").append("path").attr("d","M0 0H50V50H0z").attr("transform","translate(-16 -16)"),n.append("g").on("click",(function(){t.scaleBy(1/1.5)})).attr("class","nyang-zoom-out").attr("transform","translate(0, 38)").append("defs").append("path").attr("id","prefix__zoomout_a").attr("d","M12.5 11h-.79l-.28-.27C12.41 9.59 13 8.11 13 6.5 13 2.91 10.09 0 6.5 0S0 2.91 0 6.5 2.91 13 6.5 13c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L17.49 16l-4.99-5zm-6 0C4.01 11 2 8.99 2 6.5S4.01 2 6.5 2 11 4.01 11 6.5 8.99 11 6.5 11zM4 6h5v1H4V6z").select((function(){return this.parentNode})).select((function(){return this.parentNode})).append("rect").attr("x","2").attr("y","2").attr("rx","5").attr("ry","5").attr("width","30").attr("height","30").attr("fill","white").select((function(){return this.parentNode})).append("g").attr("fill","none").attr("fill-rule","evenodd").attr("transform","translate(9 9)").append("mask").attr("id","prefix__zoomout_b").attr("fill","#fff").append("use").attr("xedge:href","#prefix__zoomout_a").select((function(){return this.parentNode})).select((function(){return this.parentNode})).append("g").attr("fill","#666").attr("mask","url(#prefix__zoomout_b)").append("path").attr("d","M0 0H50V50H0z").attr("transform","translate(-16 -16)"),n.append("g").on("click",(function(){t.resetZoom()})).attr("class","nyang-zoom-reset").attr("transform","translate(0, 76)").append("defs").append("path").attr("id","prefix__reset_a").attr("d","M15 10c.552 0 1 .448 1 1v5h-5c-.552 0-1-.448-1-1s.448-1 1-1h3v-3c0-.552.448-1 1-1zM1 10c.552 0 1 .448 1 1v3h3c.552 0 1 .448 1 1s-.448 1-1 1H0v-5c0-.552.448-1 1-1zM16 0v5c0 .552-.448 1-1 1s-1-.448-1-1V2h-3c-.552 0-1-.448-1-1s.448-1 1-1h5zM5 0c.552 0 1 .448 1 1s-.448 1-1 1H2v3c0 .552-.448 1-1 1s-1-.448-1-1V0z").select((function(){return this.parentNode})).select((function(){return this.parentNode})).append("rect").attr("x","2").attr("y","2").attr("rx","5").attr("ry","5").attr("width","30").attr("height","30").attr("fill","white").select((function(){return this.parentNode})).append("g").attr("fill","none").attr("fill-rule","evenodd").attr("transform","translate(9 9)").append("mask").attr("id","prefix__reset_b").attr("fill","#fff").append("use").attr("xedge:href","#prefix__reset_a").select((function(){return this.parentNode})).select((function(){return this.parentNode})).append("g").attr("fill","#666").attr("mask","url(#prefix__reset_b)").append("path").attr("d","M0 0H50V50H0z").attr("transform","translate(-16 -16)")}},{key:"scaleTo",value:function(t){this.zoom.scaleTo(e.select(this.graphContainerElement).select("svg"),t)}},{key:"scaleBy",value:function(t){this.zoom.scaleBy(e.select(this.graphContainerElement).select("svg").transition().duration(a.ZOOM_TIME/2),t)}},{key:"resetZoom",value:function(){var t=e.select(this.graphContainerElement).select("g"),n=t.attr("transform"),o=n.substring(n.indexOf("scale(")+6,n.lastIndexOf(")"));o=parseFloat(o);var i=this.graphContainerElement.clientWidth,r=this.graphContainerElement.clientHeight,s=i/((t.node().getBBox().width+2*a.ZOOM_PADDING)*o),c=r/((t.node().getBBox().height+2*a.ZOOM_PADDING)*o),l=Math.min(s,c),d=t.node().getBBox().x+t.node().getBBox().width/2,u=t.node().getBBox().y+t.node().getBBox().height/2;e.select(this.graphContainerElement).select("svg").transition().duration(a.ZOOM_TIME/4).call(this.zoom.scaleBy,l).transition().call(this.zoom.translateTo,d,u)}},{key:"zoomToCoordinates",value:function(t,n,o){e.select(this.graphContainerElement).select("svg").transition().duration(a.ZOOM_TIME).call(this.zoom.transform,e.zoomIdentity.translate(t,n).scale(o)).select("g").attr("transform","translate(".concat(t,",").concat(n,")scale(").concat(o,")"))}},{key:"handleZoomRequest",value:function(e,t,n){!e&&0!==e||!t&&0!==t||!n?this.resetZoom():this.zoomToCoordinates(e,t,n)}},{key:"destroy",value:function(){this.zoomButtonContainer&&this.zoomButtonContainer.remove()}}]),n}(),E=function(){function n(e,o,i){var r=this;t(this,n),this.showContextMenu=void 0!==i.enableContextMenu?i.enableContextMenu:a.SHOW_CONTEXT_MENU,this.customContextMenuAddons=void 0!==i.customContextMenuAddons?i.customContextMenuAddons:a.DEFAULT_CUSTOM_CONTEXT_MENU,this.graphContainerElement=e,this.ee=o,this.showContextMenu&&(this.ee.on(s.RIGHT_CLICK_ENTITY,(function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;r.buildMenu(e,t)})),this.ee.on(s.CLICK_ENTITY,(function(){r.removeContextmenu()})),this.ee.on(s.GRAPH_WILL_UNMOUNT,(function(){return r.removeContextmenu()}))),this.InitializeMenuSections()}return o(n,[{key:"buildMenu",value:function(t,n){var o=e.mouse(document.body),i=o[0],r=o[1];null===t?this.createCanvasContextMenu(null,i,r):n?this.createEdgeContextMenu(t,i,r,n):this.createNodeContextMenu(t,i,r)}},{key:"createContextMenu",value:function(t,n,o,i,r){var a=this,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:void 0;this.removeContextmenu();var c=e.select(this.graphContainerElement).append("div").attr("id","nyang-context-menu-container").attr("class","nyang-context-menu").style("position","fixed").style("left",i+"px").style("top",r+"px").style("display","block").append("ul").attr("class","nyang-context-menu-options");n.forEach((function(e,n){0===n?a.processSection(c,e,!1,t,s):a.processSection(c,e,!0,t,s)})),o.forEach((function(e){a.processSection(c,e,!0,t,s)}))}},{key:"processSection",value:function(e,t,n,o){var i=this,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:void 0;n&&e.append("li").append("div").attr("class","nyang-context-menu-divider"),t.forEach((function(t){e.append("li").append("div").attr("class","nyang-context-menu-option").text((function(){return t.label})).on("click",(function(){i.removeContextmenu();var e=o&&o.data||null,n=o&&o.id||null,a=r;return t.action(e,n,a)}))}))}},{key:"createNodeContextMenu",value:function(e,t,n){var o=[this.NodeMenu,this.UniversalMenu],r=[];this.customContextMenuAddons.node&&(r=i(this.customContextMenuAddons.node)),this.createContextMenu(e,o,r,t,n)}},{key:"createEdgeContextMenu",value:function(e,t,n,o){var r=[this.EdgeMenu,this.UniversalMenu],a=[];this.customContextMenuAddons.edge&&(a=i(this.customContextMenuAddons.edge)),this.createContextMenu(e,r,a,t,n,o)}},{key:"createCanvasContextMenu",value:function(e,t,n){var o=[this.UniversalMenu],r=[];this.customContextMenuAddons.canvas&&(r=i(this.customContextMenuAddons.canvas)),this.createContextMenu(e,o,r,t,n)}},{key:"removeContextmenu",value:function(){e.select(this.graphContainerElement).select("#nyang-context-menu-container").remove()}},{key:"InitializeMenuSections",value:function(){var e=this;this.NodeMenu=[{label:"Select Node",action:function(t,n){e.ee.trigger(s.CLICK_ENTITY,{id:n,data:t})}}],this.EdgeMenu=[{label:"Select Edge",action:function(t,n,o){e.ee.trigger(s.CLICK_ENTITY,{id:n,data:t,direction:o})}}],this.UniversalMenu=[{label:"Reset Zoom",action:function(){e.ee.trigger(s.ZOOM_REQUESTED)}}]}}]),n}(),h=function(e,t){var n="";n="\n                /* Global Transitions */\n                .nyang * {\n                    transition: fill 0.1s, opacity 0.1s;\n                }\n\n                /* Text */\n                .nyang .multiplicity {\n                    font-size: ".concat(a.DEFAULT_MULTIPLICITY_FONT_SIZE,";\n                }     \n\n                /* Tooltip */\n                #nyang-tooltip {\n                  position: absolute;\n                  display: none;\n                  min-width: ").concat(a.TOOLTIP_MIN_WIDTH,";\n                  background: ").concat(a.TOOLTIP_BACKGROUND,";\n                  opacity: 0.8;\n                  color: ").concat(a.TOOLTIP_COLOR,";\n                  padding: 10px;\n                  text-align: center;\n                  max-width: ").concat(a.TOOLTIP_MAX_WIDTH,";\n                  word-wrap: break-word;\n                  font-size: 14px;\n                  border-radius: ").concat(a.TOOLTIP_BORDER_RADIUS,";\n                }\n\n                /* Context Menu Styles */\n                /* This is a rule for all paths unless specified otherwise */\n                .nyang path {\n                  stroke: #000;\n                  stroke-width: 2px;\n                }\n                \n                .nyang-context-menu {\n                  box-shadow: 0 4px 5px 3px rgba(0, 0, 0, 0.2);\n                  position: relative;\n                  display: block;\n                  background: #FFFFFF;\n                }\n                \n                .nyang-context-menu-options {\n                  min-width: 150px;\n                  list-style: none;\n                  padding: 0px;\n                  margin-top: 10px;\n                  margin-bottom: 10px;\n                }\n                \n                .nyang-context-menu-option {\n                  font-size: 14px;\n                  padding: 7px 20px 7px 20px;\n                  cursor: pointer;\n                }\n                \n                .nyang-context-menu-divider {\n                  width: 90%;\n                  height: 1px;\n                  margin-right: 5%;\n                  margin-left: 5%;\n                  margin-top: 8px;\n                  margin-bottom: 8px;\n                  background: #d5d5d5;\n                }\n                \n                .nyang-context-menu-option:hover {\n                  background: rgba(0, 0, 0, 0.2);\n                }\n                \n                .nyang-node-edge-counter-badge {\n                  fill: #505759;\n                  stroke: none !important;\n                }\n                \n                .nyang-node-edge-counter-badge-text {\n                  dominant-baseline: central;\n                  text-anchor: middle;\n                  fill: white;\n                }\n                \n                /* Search Highlighting */\n                .nyang .highlighted-node {\n                  stroke-width: ").concat(a.HIGHLIGHTING_BORDER_WIDTH,";\n                  stroke: ").concat(a.HIGHLIGHTING_BORDER_COLOR,";\n                  fill: ").concat(a.HIGHLIGHTING_COLOR,";\n                  opacity: 0.3;\n                  pointer-events: none;\n                }\n\n                .nyang .disabled {\n                    opacity: ").concat(a.DEFAULT_FADE_OPACITY,";\n                    pointer-events: none;\n                }\n\n                /* Default edge style */\n                .edge-path-default{\n                    fill: none;\n                    stroke-width: ").concat(a.DEFAULT_STROKE_WIDTH," !important;\n                    stroke-dasharray: ").concat(a.DEFAULT_EDGE_DASHARRAY," !important;\n                    stroke: ").concat(a.DEFAULT_EDGE_COLOR," !important;\n                }\n                .edge-path-default.hovered{\n                    stroke: ").concat(a.DEFAULT_LABEL_HOVER_BACKGROUND_COLOR," !important;\n                }\n                .edge-path-default.focused{\n                    stroke: ").concat(a.DEFAULT_FOCUS_COLOR," !important;\n                }\n                \n                .label-rect-default{\n                    cursor: pointer;\n                    fill: ").concat(a.DEFAULT_LABEL_BACKGROUND_COLOR,";\n                    rx: ").concat(a.DEFAULT_LABEL_BORDER_RADIUS_X,";\n                    ry: ").concat(a.DEFAULT_LABEL_BORDER_RADIUS_Y,";\n                    stroke: ").concat(a.DEFAULT_LABEL_BORDER_COLOR," !important;\n                    stroke-width: ").concat(a.DEFAULT_LABEL_BORDER_WIDTH," !important; \n                }\n                .label-rect-default:hover{\n                    fill: ").concat(a.DEFAULT_LABEL_HOVER_BACKGROUND_COLOR,";\n                    cursor: pointer;\n                }\n                .label g .label-rect-default.focused {\n                    stroke-width: ").concat(a.DEFAULT_NODE_FOCUSED_BORDER_WIDTH," !important;\n                    stroke: ").concat(a.DEFAULT_FOCUS_COLOR," !important;\n                }\n\n                .label-text-default{\n                    fill: ").concat(a.DEFAULT_LABEL_TEXT_COLOR,";\n                    dominant-baseline: central;\n                    pointer-events: none;\n                    font-family: ").concat(a.DEFAULT_FONT_FAMILY,";\n                    font-size: ").concat(a.DEFAULT_FONT_SIZE,";\n                }\n                .to:hover .label-text-default,\n                .from:hover .label-text-default{\n                    fill: ").concat(a.DEFAULT_LABEL_TEXT_HOVER_COLOR,"\n                }\n                \n                .marker-default path{\n                    fill: ").concat(a.DEFAULT_EDGE_COLOR,";\n                }\n                .marker-default path.hovered{\n                    stroke: ").concat(a.DEFAULT_LABEL_HOVER_BACKGROUND_COLOR," !important;\n                    fill: ").concat(a.DEFAULT_LABEL_HOVER_BACKGROUND_COLOR," !important;\n                    cursor: pointer;\n                }\n                .marker-default path.focused{\n                    fill: ").concat(a.DEFAULT_FOCUS_COLOR," !important;\n                    stroke: ").concat(a.DEFAULT_FOCUS_COLOR," !important;\n                }\n\n                .node, .edge, .multiplicity {\n                    animation: fadeInFromNone 0.2s ease-out;\n                }\n\n                @keyframes fadeInFromNone {\n                    0% {\n                        opacity: 0;\n                    }\n                    100% {\n                        opacity: 1;\n                    }\n                }\n\n                /* Default node values */\n                .node-default {\n                    cursor: pointer;\n                    stroke-width: ").concat(a.DEFAULT_STROKE_WIDTH,";\n                    stroke: ").concat(a.DEFAULT_NODE_STROKE_COLOR,";\n                    fill: ").concat(a.DEFAULT_NODE_COLOR,";\n                    stroke-dasharray: 0;\n                    rx: ").concat(a.DEFAULT_NODE_BORDER_RADIUS_X,";\n                    ry: ").concat(a.DEFAULT_NODE_BORDER_RADIUS_Y,";\n                }\n                .node-default:hover {\n                    fill: ").concat(a.DEFAULT_NODE_HOVER_COLOR,";\n                }\n                .node-text-default {\n                    dominant-baseline: hanging;\n                    pointer-events: none;\n                    font-family: ").concat(a.DEFAULT_FONT_FAMILY,";\n                    font-size: ").concat(a.DEFAULT_FONT_SIZE,";\n                    fill: ").concat(a.DEFAULT_NODE_TEXT_COLOR,";\n                }\n                .node:hover .node-text-default {\n                    fill: ").concat(a.DEFAULT_NODE_TEXT_HOVER_COLOR,";\n                }\n                .nyang .node-default.focused {\n                    stroke: ").concat(a.DEFAULT_FOCUS_COLOR," !important;\n                    stroke-width: ").concat(a.DEFAULT_NODE_FOCUSED_BORDER_WIDTH," !important;\n                }\n                "),e&&e.nodes&&e.nodes.forEach((function(e){n="\n                ".concat(n,"\n                .node-").concat(e.id," {\n                    cursor: pointer;\n                    ").concat(e.borderWidth?"stroke-width:".concat(e.borderWidth,";"):"","\n                    ").concat(e.borderColor?"stroke:".concat(e.borderColor,";"):"","\n                    ").concat(e.backgroundColor?"fill:".concat(e.backgroundColor,";"):"","\n                    ").concat(e.dotted?"stroke-dasharray:".concat(a.DEFAULT_NODE_DOTTED_DASHARRAY,";"):"","\n                    ").concat(e.borderRadiusX?"rx:".concat(e.borderRadiusX,";"):"","\n                    ").concat(e.borderRadiusY?"ry:".concat(e.borderRadiusY,";"):"","\n                    ").concat(e.filter?"filter:".concat(e.filter,";"):"","\n                }\n                .node-").concat(e.id,":hover {\n                    ").concat(e.borderHoverWidth?"stroke-width:".concat(e.borderHoverWidth,";"):"","\n                    ").concat(e.borderHoverColor?"stroke:".concat(e.borderHoverColor,";"):"","\n                    ").concat(e.backgroundHoverColor?"fill:".concat(e.backgroundHoverColor,";"):"","\n                    ").concat(e.hoverFilter?"filter:".concat(e.hoverFilter,";"):"","                    \n                }\n                .node-text-").concat(e.id," {\n                    font-family: ").concat(a.DEFAULT_FONT_FAMILY,";\n                    font-size: ").concat(a.DEFAULT_FONT_SIZE,";\n                    dominant-baseline: hanging;\n                    pointer-events: none;\n                    ").concat(e.textColor?"fill:".concat(e.textColor,";"):"",";\n                }\n                .node:hover .node-text-").concat(e.id," {\n                    ").concat(e.textHoverColor?"fill:".concat(e.textHoverColor,";"):"","\n                }\n                .nyang .node-").concat(e.id,".focused {\n                    ").concat(e.borderFocusedWidth?"stroke-width:".concat(e.borderFocusedWidth,";"):"","\n                    ").concat(e.borderFocusedColor?"stroke:".concat(e.borderFocusedColor," !important"):"","\n                    ").concat(e.backgroundFocusedColor?"fill:".concat(e.backgroundFocusedColor,";"):"","\n                    ").concat(e.focusedFilter?"filter:".concat(e.focusedFilter," !important;"):"","\n                }\n                .nyang .node-").concat(e.id,".focused .node-text-").concat(e.id," {\n                    ").concat(e.textFocusedColor?"fill:".concat(e.textFocusedColor,";"):"","\n                }\n                ")})),e&&e.edges&&e.edges.forEach((function(e){n="\n                ".concat(n,"\n                .edge-path-").concat(e.id,"{\n                    fill: none !important;\n                    stroke-width: ").concat(a.DEFAULT_STROKE_WIDTH," !important;\n                    stroke-dasharray: ").concat(e.dotted?a.DEFAULT_EDGE_DOTTED_DASHARRAY:a.DEFAULT_EDGE_DASHARRAY," !important;\n                    ").concat(e.color?"stroke:".concat(e.color," !important;"):"","\n                }\n                .edge-path-").concat(e.id,".hovered{\n                    ").concat(e.hoverColor?"stroke:".concat(e.hoverColor," !important;"):"","\n                }\n                .edge-path-").concat(e.id,".focused{\n                    ").concat(e.focusedColor?"stroke:".concat(e.focusedColor," !important;"):"","\n                } \n                .label-rect-").concat(e.id,"{\n                    cursor: pointer;\n                    ").concat(e.labelBackgroundColor?"fill:".concat(e.labelBackgroundColor,";"):"","\n                    ").concat(e.borderRadiusX?"rx:".concat(e.borderRadiusX,";"):"","\n                    ").concat(e.borderRadiusY?"ry:".concat(e.borderRadiusY,";"):"","\n                    ").concat(e.labelBorderColor?"stroke:".concat(e.labelBorderColor,";"):"","\n                    ").concat(e.labelBorderWidth?"stroke-width: ".concat(e.labelBorderWidth,";"):""," \n                    ").concat(e.filter?"filter:".concat(e.filter,";"):"","\n                }\n                .label-rect-").concat(e.id,":hover{\n                    ").concat(e.hoverColor?"fill:".concat(e.hoverColor,";"):"","\n                    ").concat(e.labelHoverBorderColor?"stroke:".concat(e.labelHoverBorderColor," !important;"):"","\n                    ").concat(e.labelHoverBorderWidth?"stroke-width:".concat(e.labelHoverBorderWidth," !important;"):"","\n                    ").concat(e.hoverFilter?"filter:".concat(e.hoverFilter,";"):"","\n                }\n                .label g .label-rect-").concat(e.id,".focused {\n                    ").concat(e.labelFocusedBorderWidth?"stroke-width:".concat(e.labelFocusedBorderWidth," !important;"):"","\n                    ").concat(e.focusedColor?"stroke:".concat(e.focusedColor,";"):"","\n                    ").concat(e.focusedFilter?"filter:".concat(e.focusedFilter," !important;"):"","\n                    ").concat(e.labelFocusedBorderColor?"stroke:".concat(e.labelFocusedBorderColor," !important;"):"","\n                }\n                .label-text-").concat(e.id,"{\n                    ").concat(e.labelTextColor?"fill:".concat(e.labelTextColor,";"):"",";\n                    dominant-baseline: central;\n                    pointer-events: none;\n                    font-family: ").concat(a.DEFAULT_FONT_FAMILY,";\n                    font-size: ").concat(a.DEFAULT_FONT_SIZE,";\n                }\n                .to:hover .label-text-").concat(e.id,",\n                .from:hover .label-text-").concat(e.id,"{\n                    ").concat(e.labelTextHoverColor?"fill:".concat(e.labelTextHoverColor,";"):"","\n                }\n                .marker-").concat(e.id," path.hovered{\n                    ").concat(e.hoverColor?"stroke:".concat(e.hoverColor,";"):"","\n                    ").concat(e.hoverColor?"fill:".concat(e.hoverColor,";"):"","\n                    cursor: pointer;\n                }\n                .marker-").concat(e.id," path{\n                    ").concat(e.arrowColor?"fill:".concat(e.arrowColor,";"):"","\n                }\n                .marker-").concat(e.id," path.focused{\n                    ").concat(e.focusedColor?"fill:".concat(e.focusedColor,";"):"","\n                    ").concat(e.focusedColor?"stroke:".concat(e.focusedColor,";"):"","\n                }\n                ")}));var o=document.createElement("style");o.type="text/css",o.id=t,o.appendChild(document.createTextNode(n)),document.getElementsByTagName("head")[0].appendChild(o)},f=function e(t,n,o,i,r,a,s){var c=Date.now()-r;if(c>a)t.style.removeProperty(n);else{var l=o+(i-o)*(c/a),d=s?s(l):l;t.style[n]=d,setTimeout((function(){return e(t,n,o,i,r,a,s)}),1)}},_=function(){function n(e,o,i){var r=this;t(this,n),this.graphContainerElement=e,this.ee=o,this.ee.on(s.CLICK_ENTITY,(function(e){e&&r.setElementFocus(e.id,e.direction)})),this.ee.on(s.CLICK_ENTITY,(function(e){e||r.removeAllEntityFocus()})),this.ee.on(s.HIGHLIGHT_NODE_REQUESTED,(function(e){r.highlightNode(e.map((function(e){return e.id})))})),this.ee.on(s.DISABLE_NODES_REQUESTED,(function(e){r.disableNodes(e)})),this.ee.on(s.CLEAR_DISABLE_NODES_REQUESTED,(function(){r.clearDisabled()})),this.enableOnionOnFocus="boolean"==typeof i.enableOnionOnFocus?i.enableOnionOnFocus:a.ENABLE_ONION_ON_FOCUS,this.focusedOnionNumberOfLayers=i.focusedOnionNumberOfLayers?i.focusedOnionNumberOfLayers:a.DEFAULT_ONION_FOCUSED_LAYERS,this.focusedOnionBaseColor=i.focusedOnionBaseColor?i.focusedOnionBaseColor:a.DEFAULT_ONION_FOCUSED_COLOR,this.focusedOnionLayerSize=i.focusedOnionLayerSize?i.focusedOnionLayerSize:a.DEFAULT_ONION_FOCUSED_SIZE,this.writeHighlightFilters()}return o(n,[{key:"writeHighlightFilters",value:function(){var t=this,n=function(n,o,i){e.select(t.graphContainerElement).select("defs").append("filter").attr("id",n).append("feDropShadow").attr("dx","0").attr("dy","0").attr("stdDeviation",o).attr("flood-opacity",i)};n("shadow-filter",3,.5),n("shadow-dark-filter",5,.5)}},{key:"setElementFocus",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;e&&("from"===n?t=!0:"to"===n&&(t=!1),this.removeAllEntityFocus(),this.toggleEntityFocusByID(e,t))}},{key:"removeAllEntityFocus",value:function(){e.selectAll(".focused").classed("focused",!1),this.enableOnionOnFocus&&e.selectAll(".onion-clone").attr("class","removing").transition().duration(a.DEFAULT_ONION_ANIMATION_TIME).style("transform","scale(0.8)").remove()}},{key:"toggleEntityFocusByID",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;return this.toggleNodeEntityFocus(e)||this.toggleEdgeEntityFocus(e,t)}},{key:"toggleNodeEntityFocus",value:function(t){var n=e.select("[id='".concat(t,"']"));if(n.node()){var o=n.node(),r=o.parentElement.children;return e.selectAll(i(r)).classed("focused",!n.classed("focused")),this.enableOnionOnFocus&&this.toggleOnionBorder(o,this.focusedOnionLayerSize,this.focusedOnionBaseColor,this.focusedOnionNumberOfLayers),!0}return!1}},{key:"toggleOnionBorder",value:function(t,n,o){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2,r=t.parentElement.children,s=!1;if(Array.from(r).forEach((function(t){t.classList.contains("onion-clone")&&(s=!0,e.select(t).attr("class",null).transition().duration(a.DEFAULT_ONION_ANIMATION_TIME).style("transform","scale(0.8)").remove())})),!s){var c=t,l=0;getComputedStyle(t).strokeWidth&&"rgba(0, 0, 0, 0)"!==getComputedStyle(t).stroke&&(l+=parseInt(getComputedStyle(t).strokeWidth.substring(0,getComputedStyle(t).strokeWidth.length-2))/2);for(var d=1;d<i+1;d++){var u=t.cloneNode();u.removeAttribute("class"),u.removeAttribute("id"),u.removeAttribute("style"),t.hasAttribute("r")&&u.setAttribute("r",parseInt(t.getAttribute("r"))+d*n+l),t.hasAttribute("width")&&(u.setAttribute("width",parseInt(t.getAttribute("width"))+d*(2*n)+l),u.setAttribute("height",parseInt(t.getAttribute("height"))+d*(2*n)+l),u.setAttribute("x",parseInt(t.getAttribute("x"))-d*n-l/2),u.setAttribute("y",parseInt(t.getAttribute("y"))-d*n-l/2),getComputedStyle(t).rx&&(u.style.rx=parseInt(getComputedStyle(t).rx.substring(0,getComputedStyle(t).rx.length-2))*(d+1)+"px"),getComputedStyle(t).ry&&(u.style.ry=parseInt(getComputedStyle(t).ry.substring(0,getComputedStyle(t).ry.length-2))*(d+1)+"px")),u.style.pointerEvents="none",u.style.fill=o,u.setAttribute("opacity",.5/d),u.setAttribute("class","onion-clone"),t.parentElement.insertBefore(u,c),f(u,"transform",t.getBoundingClientRect().width/u.getBoundingClientRect().width,1,Date.now(),a.DEFAULT_ONION_ANIMATION_TIME*d,(function(e){return"scale(".concat(e,")")})),c=u}return!0}return!1}},{key:"toggleEdgeEntityFocus",value:function(t,n){var o=e.select("#label".concat(t).concat(n?"from":"to"));if(o){var i=o.select("rect:not(.removing)"),r=i.classed("focused");return i.classed("focused",!r),this.enableOnionOnFocus&&this.toggleOnionBorder(i.node(),this.focusedOnionLayerSize,this.focusedOnionBaseColor,this.focusedOnionNumberOfLayers),e.selectAll('marker[id$="'.concat(t).concat(n?"inverse":"",'"]')).select("path").classed("focused",!r),e.selectAll('[class*="'.concat(t).concat(n?"inverse ":" ",'"]')).selectAll("path, text").classed("focused",!r),!0}return!1}},{key:"highlightNode",value:function(t){e.selectAll(".node").filter((function(e){return t.includes(e.id)})).append("circle").attr("r",50).classed("highlighted-node",!0).transition().duration(a.HIGHLIGHT_TIME).ease(e.easeBounce).style("transform","scale(5)").transition().duration(a.HIGHLIGHT_TIME_REMOVE).remove()}},{key:"disableNodes",value:function(t){e.selectAll(".node").filter((function(e){return t.includes(e.id)})).classed("disabled",!0),e.selectAll(".edge").filter((function(e){return t.includes(e.sourceNode)||t.includes(e.targetNode)})).classed("disabled",!0),e.selectAll(".label").filter((function(e){return t.includes(e.sourceNode)||t.includes(e.targetNode)})).classed("disabled",!0)}},{key:"clearDisabled",value:function(){e.selectAll(".disabled").classed("disabled",!1)}}]),n}(),g=function(){function n(e,o){var i=this;t(this,n),this.graphContainerElement=e,this.ee=o,this.tooltip=this.initializeTooltip(),this.ee.on(s.MOUSE_OVER_NODE,(function(e){i.showTooltip(e)})),this.ee.on(s.MOUSE_LEFT_NODE,(function(){i.hideTooltip()})),this.ee.on(s.GRAPH_WILL_UNMOUNT,(function(){return i.destroy()}))}return o(n,[{key:"initializeTooltip",value:function(){return e.select(this.graphContainerElement).append("div").attr("id","nyang-tooltip")}},{key:"showTooltip",value:function(t){var n=e.mouse(document.documentElement);this.tooltip.style("left",n[0]-window.pageXOffset+"px").style("top",n[1]+20-window.pageYOffset+"px").style("display","inline-block").style("position","fixed").html(t.name)}},{key:"hideTooltip",value:function(){this.tooltip.style("display","none")}},{key:"destroy",value:function(){this.tooltip.remove()}}]),n}(),p=function(){function n(e,o,i){t(this,n),this.graphContainerElement=e,this.enableGrid=void 0!==i.enableGrid?i.enableGrid:a.ENABLE_GRID,this.enableSecondaryGrid=void 0!==i.enableSecondaryGrid&&i.enableSecondaryGrid,this.ee=o,this.enableGrid?this.initializeGrid():this.enableSecondaryGrid&&this.initializeAlternativeGrid()}return o(n,[{key:"initializeGrid",value:function(){var t=e.select(this.graphContainerElement).select("svg").select("g").select("defs").append("pattern").attr("id","grid").attr("width",60).attr("height",60).attr("patternUnits","userSpaceOnUse");t.append("path").attr("d","M 60 0 L 0 0 0 60").attr("style","fill: none; stroke: #dedede; stroke-width: 1; stroke-dasharray: 2;"),this.createLine(t,0,0,0,2),this.createLine(t,0,0,2,0),this.createLine(t,60,60,58,60),this.createLine(t,60,60,60,58),this.createLine(t,0,58,0,60),this.createLine(t,0,60,2,60),this.createLine(t,58,0,60,0),this.createLine(t,60,0,60,2),e.select(this.graphContainerElement).select("svg").insert("rect",":first-child").attr("width","100%").attr("height","100%").attr("fill","url(#grid)")}},{key:"initializeAlternativeGrid",value:function(){e.select(this.graphContainerElement).select("svg").select("g").select("defs").append("pattern").attr("id","grid").attr("width",60).attr("height",60).attr("patternUnits","userSpaceOnUse").append("path").attr("d","M 60 0 L 0 0 0 60").attr("style","fill: none; stroke: #a0a0a0; stroke-width: 1; stroke-dasharray: 2;"),e.select(this.graphContainerElement).select("svg").insert("rect",":first-child").attr("width","100%").attr("height","100%").attr("fill","url(#grid)")}},{key:"createLine",value:function(e,t,n,o,i){e.append("line").attr("style","stroke: #a0a0a0;stroke-width:0.5;").attr("x1",t).attr("y1",n).attr("x2",o).attr("y2",i)}}]),n}(),T=e.line().x((function(e){return e.x})).y((function(e){return e.y})).curve(e.curveCardinal),D=e.line().x((function(e){return e.x})).y((function(e){return e.y})).curve(e.curveCardinal.tension(-1)),O=function(e){(e%=360)<0&&(e+=360);var t=2*Math.PI*e/360;return t<0&&(t+=2*Math.PI),t},L=function(e){var t=Math.floor((e.multiEdgeIndex-e.multiEdgeCount%2)/2)+1,n=e.multiEdgeCount%2*15,o=0;switch(t){case 1:o=20+n;break;case 2:o=45+n}return o},N=function(e,t,n){var o=t.x-e.x,i=-(t.y-e.y),r=o,a=n/Math.sqrt(i*i+r*r);return{x:i*a,y:r*a}},v={calculateCurvePoint:function(e,t,n){var o=L(n),i=t.x-e.x,r=t.y-e.y,a=e.x+i/2,s=e.y+r/2,c=N(e,t,o);return n.source.index<n.target.index&&(c.x=-c.x,c.y=-c.y),n.multiEdgeIndex%2!=0&&(c.x=-c.x,c.y=-c.y),{x:a+c.x,y:s+c.y}},calculateIntersection:function(e,t,n){var o=t.x-e.x,i=t.y-e.y,r=t.radius;if("rectangle"===t.shape)if(Math.abs(i/o)<=t.height/t.width){var a=i/(o/(t.width/2));r=Math.sqrt(Math.pow(t.width/2,2)+a*a)}else{var s=o/(i/(t.height/2));r=Math.sqrt(Math.pow(t.height/2,2)+s*s)}var c=Math.sqrt(o*o+i*i),l=(c-(r+n))/c;return{x:o*l+e.x,y:i*l+e.y}},calculateMultiEdgeDistance:L,calculateNormalVector:N,calculateRadian:O,curveFunction:T,loopFunction:D,calculateSelfEdgePath:function(e){var t=e.source,n=360/e.selfEdgeCount,o=Math.min(60,.8*n),i=O(n*e.selfEdgeIndex),r=O(n*e.selfEdgeIndex+o),a=Math.cos(i)*t.radius,s=Math.sin(i)*t.radius,c=Math.cos(r)*t.radius,l=Math.sin(r)*t.radius,d={x:t.x+a,y:t.y+s},u={x:t.x+c,y:t.y+l},E=(a+c)/2*2.5,h=(s+l)/2*2.5,f={x:t.x+E,y:t.y+h};return e.curvePoint=f,D([d,f,u])},calculateLabelAngle:function(e,t){var n=e.x-t.x,o=e.y-t.y,i=Math.atan2(o,n)*(180/Math.PI);return(i+=180)>90&&i<270&&(i-=180),i}},I=function(){function n(e,o,i){var r=this;t(this,n),this.enableFadeOnHover=void 0!==i.enableFadeOnHover?i.enableFadeOnHover:a.DEFAULT_FADE_ON_HOVER,this.showMultiplicity=!0,this.enableMultiLineNodeLabels=void 0!==i.enableMultiLineNodeLabels?i.enableMultiLineNodeLabels:a.DEFAULT_NODE_TEXT_MULTILINE,this.rotateLabels=void 0!==i.rotateLabels?i.rotateLabels:a.ROTATE_LABELS,this.rootG=e,this.nodes=[],this.edges=[],this.listeningForTick=!1,this.ee=o,this.ee.on(s.TOGGLE_MULTIPLICITY_REQUESTED,(function(){r.showMultiplicity=!r.showMultiplicity,r.updateMultiplicityCounters(r.edges)})),this.ee.on(s.DATASTORE_UPDATED,(function(e,t){r.nodes=e,r.edges=t,r.updateMarkers(t),r.updateEdges(t),r.updateLabels(t),r.updateMultiplicityCounters(t),r.updateNodes(e),r.attachEntityClickListeners(),r.ee.trigger(s.DOM_PROCESSOR_FINISHED,e,t)})),this.ee.on(s.ENGINE_TICK,(function(){r.listeningForTick&&r.tick()})),this.ee.on(s.GRAPH_HAS_MOUNTED,(function(){r.listeningForTick=!0}))}return o(n,[{key:"updateMarkers",value:function(e){var t=this,n=this.rootG.select("defs");n.selectAll("marker").remove(),e.forEach((function(e){t.drawMarker(n,e,!1),e.nameFrom&&t.drawMarker(n,e,!0)}))}},{key:"updateEdges",value:function(e){var t=this,n=this.rootG.select("#edge-container").selectAll(".edge").data(e,(function(e){return e.id}));n.exit().remove(),n.enter().append("g").attr("class",(function(e){return t.getMarkerId(e,!0)+" "+t.getMarkerId(e,!1)})).classed("edge",!0).append("path").attr("class",(function(e){return"edge-path-".concat(e.type?e.type:"default")})).attr("marker-end",(function(e){return"url(#"+t.getMarkerId(e,!1)+")"})).attr("marker-start",(function(e){return e.nameFrom?"url(#"+t.getMarkerId(e,!0)+")":""})),this.edgePath=this.rootG.select("#edge-container").selectAll(".edge path")}},{key:"updateMultiplicityCounters",value:function(t){var n=this;if(this.showMultiplicity){var o=this.rootG.select("#multiplicity-container").selectAll(".multiplicity").data(t,(function(e){return e.id}));o.exit().remove(),o.enter().append("g").classed("multiplicity",!0).filter((function(e){return e.multiplicityTo||e.multiplicityFrom})).each((function(t,o,i){t.multiplicityFrom&&n.drawMultiplicity(e.select(i[o]),"from"),t.multiplicityTo&&n.drawMultiplicity(e.select(i[o]),"to")}))}else this.rootG.select("#multiplicity-container").selectAll(".multiplicity").remove();this.activeMultiplicities=this.rootG.select("#multiplicity-container").selectAll(".multiplicity").selectAll("g")}},{key:"updateNodes",value:function(t){var n=this,o=this.rootG.select("#node-container").selectAll(".node").data(t,(function(e){return e.id}));o.exit().remove(),o.enter().append("g").attr("class","node").call(e.drag().on("start",(function(e){n.ee.trigger(s.NODE_DRAG_START,e),e.fx=e.x,e.fy=e.y})).on("drag",(function(t){n.ee.trigger(s.NODE_DRAG_DRAGGED,t),t.fx=e.event.x,t.fy=e.event.y})).on("end",(function(e){e.fx=null,e.fy=null,n.ee.trigger(s.NODE_DRAG_ENDED,e)}))).each((function(t,o,i){var r=e.select(i[o]);n.drawNode(r,t)})),t.forEach((function(t){if(e.select("[id='badge-".concat(t.id,"-hidden-edge-counter']")).remove(),t.hiddenEdgeCount){var o=e.select("[id='".concat(t.id,"']")).select((function(){return this.parentNode}));n.drawNodeCollapsedEdgeCounter(o,t)}})),this.nodeElements=this.rootG.select("#node-container").selectAll(".node")}},{key:"updateLabels",value:function(t){var n=this,o=this.rootG.select("#label-container").selectAll(".label").data(t,(function(e){return e.id}));o.exit().remove(),o.enter().append("g").classed("label",!0).filter((function(e){return e.nameTo||e.nameFrom})).each((function(t,o,i){t.nameFrom&&n.drawLabel(e.select(i[o]),t,"from"),t.nameTo&&n.drawLabel(e.select(i[o]),t,"to")})),this.labels=this.rootG.select("#label-container").selectAll(".label").selectAll("g")}},{key:"getEdgeDistance",value:function(e){return(void 0!==e.target.radius?e.target.radius:0)+(void 0!==e.source.radius?e.source.radius:0)+e.edgeDistance}},{key:"getMarkerId",value:function(e,t){return(e.type?e.type:"normal")+e.id+(t?"inverse":"")}},{key:"drawMarker",value:function(e,t,n){e.append("marker").attr("id",this.getMarkerId(t,n)).attr("viewBox","0 -8 14 16").attr("refX",n?0:12).attr("refY",0).attr("markerWidth",12).attr("markerHeight",12).attr("markerUnits","userSpaceOnUse").attr("orient","auto").attr("class",(t.type?t.type:"normal")+"Marker").attr("class","marker-"+(t.type?t.type:"default")).append("path").attr("d",(function(){return n?"M12,-8L0,0L12,8Z":"M0,-8L12,0L0,8Z"}))}},{key:"drawLabel",value:function(e,t,n){var o=e.append("g").attr("id","label"+t.id+n).classed(n,!0);this.drawLabelRect(o,t,n);var i=o.append("text").attr("class",(function(){return"label-text-".concat(t.type?t.type:"default")})).attr("text-anchor","middle");this.drawLabelText(i,t,n)}},{key:"drawLabelRect",value:function(e,t,n){var o=this,i="to"===n?t.nameToWidth:t.nameFromWidth;e.append("rect").attr("class",(function(){return"label-rect-".concat(t.type?t.type:"default")})).attr("x",-i/2).attr("y",-a.LABEL_HEIGHT/2).attr("width",i).attr("height",a.LABEL_HEIGHT).on("mouseenter",(function(e){o.labelMouseEnter(e,n)})).on("mouseleave",(function(e){o.labelMouseLeave(e,n)}))}},{key:"drawLabelText",value:function(e,t,n){e.append("tspan").text((function(){var e="to"===n?t.nameToWidth:t.nameFromWidth;return("to"===n?t.nameTo:"from"===n?t.nameFrom:t.nameTo?t.nameTo:t.nameFrom).toString().truncate(e)}))}},{key:"labelMouseEnter",value:function(t,n){var o=this,i="from"===n;e.selectAll("marker#"+this.getMarkerId(t,i)).select("path").classed("hovered",!0),e.selectAll("."+this.getMarkerId(t,i)).selectAll("path, text").classed("hovered",!0),setTimeout((function(){var n=e.selectAll("marker#"+o.getMarkerId(t,i)).select("path");n._groups[0].length>0&&n.classed("hovered")&&(o.handleHoverEvent(t,"enter"),o.rootG.selectAll(".label").sort((function(e,n){return e.id===t.id&&n.id!==t.id?1:e.id!==t.id&&n.id===t.id?-1:e.id-n.id})))}),250)}},{key:"labelMouseLeave",value:function(t,n){this.handleHoverEvent(t,"leave");var o="from"===n;e.selectAll("marker#"+this.getMarkerId(t,o)).select("path").classed("hovered",!1),e.selectAll("."+this.getMarkerId(t,o)).selectAll("path, text").classed("hovered",!1)}},{key:"drawMultiplicity",value:function(e,t){var n=this;e.append("g").attr("class",(function(e){return n.getMarkerId(e,"to"===t)})).classed(t,!0).append("text").attr("text-anchor","middle").text((function(e){return"to"===t?e.multiplicityTo:e.multiplicityFrom}))}},{key:"drawNode",value:function(e,t){var n=this,o=e.append("g"),i=0,r=0,c="middle";switch(t.shape){case"circle":e.insert("circle","g").attr("r",(function(e){return e.radius})).attr("class","node-".concat(t.type?t.type:"default")).attr("id",t.id),t.icon&&(this.drawIcon(o,t.icon),r=a.DEFAULT_NODE_ICON_PADDING);break;case"layeredCircle":e.insert("circle","g").attr("r",(function(e){return e.radius})).attr("style","stroke-width:2;fill:#fff;stroke:#000;stroke-dasharray:0;pointer-events:none;").attr("id",t.id),e.insert("circle","g").attr("r",(function(e){return e.radius-4})).attr("class","node-".concat(t.type?t.type:"default")),t.icon&&(this.drawIcon(o,t.icon),r=a.DEFAULT_NODE_ICON_PADDING);break;case"rectangle":if(e.insert("rect","g").attr("x",(function(e){return-e.width/2})).attr("y",(function(e){return-e.height/2})).attr("width",(function(e){return e.width})).attr("height",(function(e){return e.height})).attr("class","node-".concat(t.type?t.type:"default")).attr("id",t.id),t.icon){var l=this.drawIcon(e,t.icon);l.attr("y",-a.DEFAULT_NODE_ICON_SIZE/2),l.attr("x",-e.node().getBBox().width/2+a.ADDITIONAL_TEXT_SPACE),i+=-e.node().getBBox().width/2+a.ADDITIONAL_TEXT_SPACE+a.DEFAULT_NODE_ICON_SIZE+a.DEFAULT_NODE_ICON_PADDING,c="start"}break;default:console.error("NO SHAPE FOUND FOR NODE")}if(e.on("mouseenter",(function(e){n.handleHoverEvent(e,"enter")})).on("mouseleave",(function(e){n.handleHoverEvent(e,"leave")})).on("mousemove",(function(e){n.ee.trigger(s.MOUSE_OVER_NODE,e)})).on("mouseout",(function(e){n.ee.trigger(s.MOUSE_LEFT_NODE,e)})),this.drawTextBlock(o,c),this.enableMultiLineNodeLabels){var d=t.name,u=d.truncate(t.maxTextWidth);if(u.length<d.length&&u.lastIndexOf(" ")>-1){u=u.substring(0,u.lastIndexOf(" "));var E=d.substring(u.length+1).truncate(t.maxTextWidth);E.length+u.length+1<d.length&&(E=E.substring(0,E.length-3)+"..."),this.drawTextline(o.select("text"),u,t.type?t.type:"default",o.node().getBBox().height+r),this.drawTextline(o.select("text"),E,t.type?t.type:"default",o.node().getBBox().height)}else u.length<d.length&&(u=u.substring(0,u.length-3)+"..."),this.drawTextline(o.select("text"),u,t.type?t.type:"default",o.node().getBBox().height+r)}else this.drawTextline(o.select("text"),t.name.truncate(t.maxTextWidth),t.type?t.type:"default",o.node().getBBox().height+r);o.attr("transform","translate(".concat(i,", ").concat(-o.node().getBBox().height/2-o.node().getBBox().y,")"))}},{key:"drawIcon",value:function(e,t){return e.append("image").attr("href",t).attr("width",a.DEFAULT_NODE_ICON_SIZE).attr("height",a.DEFAULT_NODE_ICON_SIZE).attr("x",-a.DEFAULT_NODE_ICON_SIZE/2).attr("style","pointer-events: none;")}},{key:"drawTextBlock",value:function(e,t){e.append("text").attr("text-anchor",t||"middle")}},{key:"drawTextline",value:function(e,t,n,o){e.append("tspan").attr("class","node-text-".concat(n)).attr("x",0).attr("y",o).text(t)}},{key:"drawNodeCollapsedEdgeCounter",value:function(e,t){var n,o,i,r,a,s="".concat(t.hiddenEdgeCount),c=s.width(),l=(t.radius?2*t.radius:t.height)/2,d=(t.radius?2*t.radius:t.width)/2,u=c+16;e.append("g").attr("id","badge-"+t.id+"-hidden-edge-counter").attr("style","pointer-events:none;").attr("transform","translate(".concat(d," ").concat(l,")")).append("path").attr("d",(n=-u/2,o=-15,i=u,r=30,a=10,"M".concat(n,",").concat(o,"\n\t\t\t\th").concat(i-a,"\n\t\t\t\tq").concat(a,",0 ").concat(a,",").concat(a,"\n\t\t\t\tv").concat(r-2*a,"\n\t\t\t\tq0,").concat(a," ").concat(-a,",").concat(a,"\n\t\t\t\th").concat(2*a-i,"\n\t\t\t\tq").concat(-a,",0 ").concat(-a,",").concat(-a,"\n\t\t\t\tz"))).attr("class","nyang-node-edge-counter-badge").select((function(){return this.parentNode})).append("text").attr("class","nyang-node-edge-counter-badge-text").append("tspan").attr("style","font-size:".concat(14,";")).text("".concat(s))}},{key:"attachEntityClickListeners",value:function(){var t=this,n=null;this.rootG.selectAll(".node").on("click",(function(o){e.event.stopPropagation(),clearTimeout(n),n=setTimeout((function(){t.ee.trigger(s.CLICK_ENTITY,{id:o.id,data:o.data})}),a.DOUBLE_CLICK_THRESHOLD)})).on("dblclick",(function(o){e.event.stopPropagation(),clearTimeout(n),t.ee.trigger(s.DBL_CLICK_ENTITY,{id:o.id,data:o.data})})).on("contextmenu",(function(n){e.event.preventDefault(),e.event.stopPropagation(),t.ee.trigger(s.RIGHT_CLICK_ENTITY,n)})),this.rootG.selectAll(".label .from").on("click",(function(o){e.event.stopPropagation(),clearTimeout(n),n=setTimeout((function(){t.ee.trigger(s.CLICK_ENTITY,{id:o.id,data:o.data,direction:"from"})}),a.DOUBLE_CLICK_THRESHOLD)})).on("dblclick",(function(n){e.event.stopPropagation(),t.ee.trigger(s.DBL_CLICK_ENTITY,{id:n.id,data:n.data,direction:"from"})})).on("contextmenu",(function(n){e.event.preventDefault(),e.event.stopPropagation(),t.ee.trigger(s.RIGHT_CLICK_ENTITY,n,"from")})),this.rootG.selectAll(".label .to").on("click",(function(o){e.event.stopPropagation(),clearTimeout(n),n=setTimeout((function(){t.ee.trigger(s.CLICK_ENTITY,{id:o.id,data:o.data,direction:"to"})}),a.DOUBLE_CLICK_THRESHOLD)})).on("dblclick",(function(n){e.event.stopPropagation(),t.ee.trigger(s.DBL_CLICK_ENTITY,{id:n.id,data:n.data,direction:"from"})})).on("contextmenu",(function(n){e.event.preventDefault(),e.event.stopPropagation(),t.ee.trigger(s.RIGHT_CLICK_ENTITY,n,"to")}))}},{key:"handleHoverEvent",value:function(t,n){if(this.ee.trigger(s.HOVER_ENTITY,{eventType:n,id:t.id,data:t.data}),this.enableFadeOnHover&&!t.sourceNode){var o=this.edges.filter((function(e){return e.sourceNode===t.id||e.targetNode===t.id})),i=o.reduce((function(e,t){return e.push(t.targetNode),e.push(t.sourceNode),e}),[]);i.push(t.id);var r="enter"===n?""+a.DEFAULT_FADE_OPACITY:"1";e.selectAll(".node").filter((function(e){return void 0===i.find((function(t){return t===e.id}))})).transition().duration(a.FADE_TIME).ease(e.easeLinear).style("opacity",r),e.selectAll(".edge").filter((function(e){return void 0===o.find((function(t){return t.id===e.id}))})).transition().duration(a.FADE_TIME).ease(e.easeLinear).style("opacity",r),e.selectAll(".label").filter((function(e){return void 0===o.find((function(t){return t.id===e.id}))})).transition().duration(a.FADE_TIME).ease(e.easeLinear).style("opacity",r)}}},{key:"tick",value:function(){var t=this;this.nodeElements.attr("transform",(function(e){return"translate("+e.x+","+e.y+")"})),this.edgePath.attr("d",(function(e){if(e.source.x===e.target.x&&e.source.y===e.target.y&&e.source.id!==e.target.id)return"";if(e.source===e.target)return v.calculateSelfEdgePath(e);t.rotateLabels&&(e.angle=v.calculateLabelAngle(e.source,e.target));var n=v.calculateIntersection(e.target,e.source,1),o=v.calculateIntersection(e.source,e.target,1),i=v.calculateCurvePoint(n,o,e);return e.curvePoint=i,v.curveFunction([v.calculateIntersection(e.curvePoint,e.source,1),i,v.calculateIntersection(e.curvePoint,e.target,1)])})),this.activeMultiplicities.attr("transform",(function(t){var n;n=e.select(this).classed("to")?v.calculateIntersection(t.curvePoint,t.source,a.MULTIPLICITY_HDISTANCE):v.calculateIntersection(t.curvePoint,t.target,a.MULTIPLICITY_HDISTANCE);var o=v.calculateNormalVector(t.curvePoint,t.source,a.MULTIPLICITY_VDISTANCE);return t.source.index<t.target.index&&(o.x=-o.x,o.y=-o.y),"translate("+(n.x+o.x)+","+(n.y+o.y)+")"})),this.labels.attr("transform",(function(t){if(t.source.x===t.target.x&&t.source.y===t.target.y&&t.source.id!==t.target.id)return"";var n=e.select(this),o=t.curvePoint.x,i=t.curvePoint.y;return t.nameFrom&&(n.classed("to")?i+=a.LABEL_HEIGHT/2+1:n.classed("from")&&(i-=a.LABEL_HEIGHT/2+1)),t.angle?"translate("+o+","+i+") rotate("+t.angle+")":"translate("+o+","+i+")"}))}}]),n}(),y=function(){function n(e,o,i,r){var a=this;t(this,n),this.graphContainerElement=e,this.style=i,this.ee=o,this.ee.on(s.GRAPH_WILL_UNMOUNT,(function(){return a.destroy()})),this.zoomHandler=new u(this.graphContainerElement,this.ee,r),this.contextMenu=new E(this.graphContainerElement,this.ee,r),this.tooltip=new g(this.graphContainerElement,this.ee),this.stylesID=("A"+Math.random()).replace(".","").replace(",",""),h(this.style,this.stylesID),this.rootG=this.initializeDOM(),this.highlighter=new _(this.graphContainerElement,this.ee,r),this.grid=new p(this.graphContainerElement,this.ee,r),this.DOMProcessor=new I(this.rootG,this.ee,r)}return o(n,[{key:"initializeDOM",value:function(){var t=this,n=e.select(this.graphContainerElement).insert("svg","*").attr("class","nyang").classed("svgGraph",!0).attr("width","100%").attr("height","100%").on("click",(function(){e.event.stopPropagation(),t.ee.trigger(s.CLICK_ENTITY,null)})).on("contextmenu",(function(){e.event.preventDefault(),e.event.stopPropagation(),t.ee.trigger(s.RIGHT_CLICK_ENTITY,null)})).call(this.zoom).on("dblclick.zoom",null).append("g");return n.append("defs"),n.append("g").attr("id","edge-container"),n.append("g").attr("id","label-container"),n.append("g").attr("id","multiplicity-container"),n.append("g").attr("id","node-container"),n}},{key:"destroy",value:function(){this.rootG.select("#edge-container").selectAll(".edge").remove(),this.rootG.select("#multiplicity-container").selectAll(".multiplicity").remove(),this.rootG.select("#node-container").selectAll(".node").remove(),this.rootG.select("#label-container").selectAll(".label").remove(),e.select(this.graphContainerElement).select("svg").remove(),e.select("#".concat(this.stylesID)).remove()}},{key:"zoom",get:function(){return this.zoomHandler.zoom}},{key:"context",get:function(){return this.contextMenu}},{key:"width",get:function(){return this.graphContainerElement.offsetWidth}},{key:"height",get:function(){return this.graphContainerElement.offsetHeight}}]),n}(),A=function(){function n(e,o,i){var r=this;t(this,n),this.ee=i,this.ee.on(s.DOM_PROCESSOR_FINISHED,(function(e,t){r.updateSimulation(e,t),r.ee.trigger(s.ENGINE_UPDATE_FINISHED,e,t)})),this.ee.on(s.NODE_DRAG_START,(function(){r.stop(),r.target(.5)})),this.ee.on(s.NODE_DRAG_DRAGGED,(function(){r.restart()})),this.ee.on(s.NODE_DRAG_ENDED,(function(){r.target(0)})),this.ee.on(s.CLICK_ENTITY,(function(){r.alpha(0)})),this.ee.on(s.NODE_FIXATION_REQUESTED,(function(){r.alpha(1),r.restart()})),this.ee.on(s.ENGINE_LAYOUT_REQUESTED,(function(e,t,n,o,i){r.createLayout(e,t,n,o,i)})),this.ee.on(s.ENGINE_LAYOUT_RESET_REQUESTED,(function(e,t){r.resetLayout(e,t),r.alpha(2),r.restart()})),this.ee.on(s.IMPLODE_EXPLODE_REQUESTED,(function(){r.alpha(.5),r.restart()})),this.ee.on(s.IMPLODE_EXPLODE_LEAFS_REQUESTED,(function(){r.alpha(.5),r.restart()})),this.ee.on(s.IMPLODE_EXPLODE_RECURSIVE_REQUESTED,(function(){r.alpha(.5),r.restart()})),this.ee.on(s.IMPLODE_EXPLODE_NON_CIRCULAR_REQUESTED,(function(){r.alpha(.5),r.restart()})),this.ee.on(s.TOGGLE_MULTIPLICITY_REQUESTED,(function(){r.alpha(.01),r.restart()})),this.ee.on(s.GRAPH_WILL_UNMOUNT,(function(){return r.stop()})),this.forceCenterX=e,this.forceCenterY=o,this.simulation=this.initializeSimulation()}return o(n,[{key:"initializeSimulation",value:function(){var t=this;return e.forceSimulation().force("charge",e.forceManyBody().strength(a.CHARGE)).force("center",e.forceCenter(this.forceCenterX,this.forceCenterY)).force("y",e.forceY(0).strength(a.GRAVITY)).force("x",e.forceX(0).strength(a.GRAVITY)).nodes([]).force("link",e.forceLink().links([]).distance((function(e){return t.getEdgeDistance(e)})).strength(a.EDGE_STRENGTH)).on("tick",(function(){t.ee.trigger(s.ENGINE_TICK)}))}},{key:"updateSimulation",value:function(t,n){var o=this;this.simulation.nodes(t),this.simulation.force("link",e.forceLink().links(n).distance((function(e){return o.getEdgeDistance(e)})).strength(a.EDGE_STRENGTH)),this.simulation.alpha(1).restart()}},{key:"stop",value:function(){this.simulation.stop()}},{key:"restart",value:function(){this.simulation.restart()}},{key:"alpha",value:function(e){this.simulation.alpha(e)}},{key:"target",value:function(e){this.simulation.alphaTarget(e)}},{key:"decay",value:function(e){this.simulation.alphaDecay(e)}},{key:"createLayout",value:function(t,n,o,r,a){var s,c=this;a&&(t=t.sort((function(e,t){return a(e,t)}))),s=r?t.map((function(e){return r(e.data)})):t.map((function(e){return e[o]}));var l=i(new Set(s)),d=Math.ceil(Math.sqrt(l.length)),u=0,E=0,h=l.map((function(){return E===d&&(E=0,u+=1),[u,(E+=1)-1]})),f=e.scalePoint().domain(i(Array(d).keys())).range([30,2e3]),_=e.scalePoint().domain(i(Array(d).keys())).range([30,2e3]);this.simulation.force("x",e.forceX((function(e){var t;return t=r?r(e.data):e[o],f(h[l.indexOf(t)][1])}))).force("y",e.forceY((function(e){var t;return t=r?r(e.data):e[o],_(h[l.indexOf(t)][0])}))).force("link",e.forceLink().links(n).distance((function(e){return c.getEdgeDistance(e)})).strength(0)).force("charge",e.forceManyBody().strength(-800)).alpha(1).restart()}},{key:"resetLayout",value:function(t,n){var o=this;this.simulation.force("y",e.forceY(0).strength(a.GRAVITY)).force("x",e.forceX(0).strength(a.GRAVITY)).force("link",e.forceLink().links(n).distance((function(e){return o.getEdgeDistance(e)})).strength(a.EDGE_STRENGTH)).force("charge",e.forceManyBody().strength(a.CHARGE))}},{key:"getEdgeDistance",value:function(e){return(void 0!==e.target.radius?e.target.radius:0)+(void 0!==e.source.radius?e.source.radius:0)+e.edgeDistance}}]),n}();return function(){function e(n,o,i){var r=this;t(this,e),this._options=Object.assign.apply(Object,[{}].concat(i)),this._style=o.style?JSON.parse(JSON.stringify(o.style)):{},this._ee=new d,this._options.entityClickedListener&&this._ee.on(s.CLICK_ENTITY,this._options.entityClickedListener),this._options.entityDoubleClickedListener&&this._ee.on(s.DBL_CLICK_ENTITY,this._options.entityDoubleClickedListener),this._options.entityHoveredListener&&this._ee.on(s.HOVER_ENTITY,this._options.entityHoveredListener),this._UI=new y(n,this._ee,this._style,i),this._datastore=new l(o.nodes,o.edges,this._ee,this._style,this._options),this._engine=new A(this._UI.width/2,this._UI.height/2,this._ee),this._ee.on(s.GRAPH_HAS_MOUNTED,(function(){r._UI.zoomHandler.scaleTo(a.INITIAL_SCALE)})),this._ee.trigger(s.GRAPH_HAS_MOUNTED)}return o(e,[{key:"setFilters",value:function(e){this._ee.trigger(s.DATA_FILTER_REQUESTED,e)}},{key:"getFilters",value:function(){return this._datastore.filters}},{key:"resetAllFilters",value:function(){this._ee.trigger(s.DATA_FILTER_RESET_REQUESTED)}},{key:"toggleMultiplicity",value:function(){this._ee.trigger(s.TOGGLE_MULTIPLICITY_REQUESTED)}},{key:"highlight",value:function(e,t,n){if(!(e&&t||n))throw new Error("No attribute, value or filterfunction provided");var o=this._datastore.nodes.filter((function(o){return n?n(o.data):o[e].toUpperCase().includes(t.toUpperCase())}));this._ee.trigger(s.HIGHLIGHT_NODE_REQUESTED,o)}},{key:"disable",value:function(e,t,n){if(!(e&&t||n))throw new Error("No attribute, value or filterfunction provided");var o=this._datastore.nodes.filter((function(o){return n?n(o.data):o[e].toUpperCase().includes(t.toUpperCase())})).map((function(e){return e.id}));this._ee.trigger(s.DISABLE_NODES_REQUESTED,o)}},{key:"clearDisable",value:function(){this._ee.trigger(s.CLEAR_DISABLE_NODES_REQUESTED)}},{key:"resetZoom",value:function(){this._ee.trigger(s.ZOOM_REQUESTED,null,null,null)}},{key:"zoomToNode",value:function(e){var t=this._datastore.nodes.find((function(t){return t.id===e}));if(!t)throw new Error("No such node: "+e);var n=this._UI.graphContainerElement.offsetWidth/2,o=this._UI.graphContainerElement.offsetHeight/2,i=1.5*-t.x+n,r=1.5*-t.y+o;this._ee.trigger(s.ZOOM_REQUESTED,i,r,1.5)}},{key:"setMatrixLayout",value:function(e,t,n){this._ee.trigger(s.ENGINE_LAYOUT_REQUESTED,this._datastore.nodes,this._datastore.edges,e,t,n)}},{key:"resetLayout",value:function(){this._ee.trigger(s.ENGINE_LAYOUT_RESET_REQUESTED,this._datastore.nodes,this._datastore.edges)}},{key:"centerNode",value:function(e){var t=this._datastore.nodes.find((function(t){return t.id===e}));if(t){var n=this._UI.rootG.node().getBBox().width/4,o=this._UI.rootG.node().getBBox().height/4;this._ee.trigger(s.NODE_FIXATION_REQUESTED,t,n,o)}}},{key:"implodeOrExplodeNode",value:function(e,t){this._ee.trigger(s.IMPLODE_EXPLODE_REQUESTED,e,t)}},{key:"implodeOrExplodeNodeLeafs",value:function(e,t){this._ee.trigger(s.IMPLODE_EXPLODE_LEAFS_REQUESTED,e,t)}},{key:"implodeOrExplodeNodeRecursive",value:function(e,t){this._ee.trigger(s.IMPLODE_EXPLODE_RECURSIVE_REQUESTED,e,t)}},{key:"implodeOrExplodeNodeNonCircular",value:function(e,t){this._ee.trigger(s.IMPLODE_EXPLODE_NON_CIRCULAR_REQUESTED,e,t)}},{key:"updateDataset",value:function(e){this._ee.trigger(s.DATA_UPDATE_REQUESTED,e.nodes,e.edges)}},{key:"saveGraphAsJSON",value:function(e){if(this._datastore.allNodes||this._datastore.allEdges){var t={style:this._style,nodes:e?this._datastore.liveNodes:this._datastore.allNodes,edges:e?this._datastore.liveEdges:this._datastore.allEdges},n=new Blob([JSON.stringify(t,null,null)],{type:"text/json"}),o=document.createElement("a");o.download="nyang.json",o.href=window.URL.createObjectURL(n),o.dataset.downloadurl=["text/json",o.download,o.href].join(":"),o.click()}}},{key:"destroyGraph",value:function(){var e=this;this._ee.trigger(s.GRAPH_WILL_UNMOUNT),Object.keys(this).forEach((function(t){delete e[t]}))}}]),e}()}));
